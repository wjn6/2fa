import{Y as a,r as e,o as l,O as s,P as t,Q as i,Z as d,b as o,a1 as n,R as r,_ as u,$ as c,E as v}from"./vendor-d600c78b.js";import{u as m}from"./index-64ce2276.js";import{u as p,s as f,e as g,t as w}from"./index-42d0e3ec.js";import{_ as h}from"./_plugin-vue_export-helper-1b428a4d.js";import{M as y}from"./ui-703c31fd.js";import"./utils-783a0963.js";const b={class:"profile-page"},P={class:"header"},_={class:"header-content"},k={class:"profile-content app-container"},C={class:"info-section"},x={class:"section-title"},V={class:"info-card app-card"},z={class:"avatar-section"},j={class:"avatar"},U={class:"user-info"},q={class:"username"},A={class:"info-item"},R={class:"item-label"},$={class:"item-value"},D={key:0},E={class:"info-item"},F={class:"item-label"},I={class:"item-value"},L={class:"info-item"},M={class:"item-label"},N={class:"item-value"},O={class:"info-item"},Q={class:"item-label"},S={class:"item-value"},T={class:"security-section"},Y={class:"section-title"},Z={class:"security-card app-card"},B={class:"item-left"},G={class:"stats-section"},H={class:"section-title"},J={class:"stats-grid"},K={class:"stat-card"},W={class:"stat-icon",style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}},X={class:"stat-info"},aa={class:"stat-value"},ea={class:"stat-card"},la={class:"stat-icon",style:{background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"}},sa={class:"stat-info"},ta={class:"stat-value"},ia={class:"stat-card"},da={class:"stat-icon",style:{background:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"}},oa={class:"stat-info"},na={class:"stat-value"},ra=h({__name:"Profile",setup(h){const ra=a(),ua=m(),ca=e(null),va=e(!1),ma=e({email:""}),pa=e(!1),fa=e(!1),ga=e(null),wa=e({secretCount:0,categoryCount:0,tagCount:0}),ha=e({oldPassword:"",newPassword:"",confirmPassword:""}),ya={oldPassword:[{required:!0,message:"请输入旧密码"}],newPassword:[{required:!0,message:"请输入新密码"},{min:6,message:"密码至少6个字符"}],confirmPassword:[{required:!0,message:"请再次输入新密码"},{validator:a=>a===ha.value.newPassword,message:"两次输入的密码不一致"}]},ba=a=>{if(!a)return"未知";return new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},Pa=async()=>{try{const a=await p.getCurrentUser();a.data.success&&(ca.value=a.data.data,ma.value.email=a.data.data.email||"")}catch(a){y.error("获取用户信息失败")}},_a=()=>{var a;va.value=!0,ma.value.email=(null==(a=ca.value)?void 0:a.email)||""},ka=()=>{var a;va.value=!1,ma.value.email=(null==(a=ca.value)?void 0:a.email)||""},Ca=async()=>{var a,e;try{(await p.updateProfile({email:ma.value.email})).data.success&&(y.success("邮箱更新成功"),va.value=!1,await Pa())}catch(l){y.error((null==(e=null==(a=l.response)?void 0:a.data)?void 0:e.message)||"更新邮箱失败")}},xa=()=>{ha.value={oldPassword:"",newPassword:"",confirmPassword:""},pa.value=!0},Va=async()=>{var a,e;if(await ga.value.validate()){fa.value=!0;try{(await p.changePassword({oldPassword:ha.value.oldPassword,newPassword:ha.value.newPassword})).data.success&&(y.success("密码修改成功，请重新登录"),pa.value=!1,setTimeout(()=>{ua.logout(),ra.push("/login")},1500))}catch(l){y.error((null==(e=null==(a=l.response)?void 0:a.data)?void 0:e.message)||"修改密码失败")}finally{fa.value=!1}}};return l(()=>{Pa(),(async()=>{var a,e,l;try{const[s,t,i]=await Promise.all([f.getAll(),g.getAll(),w.getAll()]);wa.value={secretCount:(null==(a=s.data.data)?void 0:a.length)||0,categoryCount:(null==(e=t.data.data)?void 0:e.length)||0,tagCount:(null==(l=i.data.data)?void 0:l.length)||0}}catch(s){}})()}),(a,e)=>{var l,m,p,f,g,w,h;const y=s("t-icon"),ra=s("t-divider"),ua=s("t-input"),Pa=s("t-button"),za=s("t-space"),ja=s("t-form-item"),Ua=s("t-form"),qa=s("t-alert"),Aa=s("t-dialog");return t(),i("div",b,[d("div",P,[d("div",_,[d("div",{class:"back-btn",onClick:e[0]||(e[0]=e=>a.$router.back())},[o(y,{name:"chevron-left",size:"20px"}),e[6]||(e[6]=d("span",null,"返回",-1))]),e[7]||(e[7]=d("h1",null,"个人中心",-1))])]),d("div",k,[d("div",C,[d("div",x,[o(y,{name:"user"}),e[8]||(e[8]=d("span",null,"基本信息",-1))]),d("div",V,[d("div",z,[d("div",j,[o(y,{name:"user",size:"40px"})]),d("div",U,[d("div",q,n(null==(l=ca.value)?void 0:l.username),1),d("div",{class:r(["role-badge",null==(m=ca.value)?void 0:m.role])},n("admin"===(null==(p=ca.value)?void 0:p.role)?"管理员":"普通用户"),3)])]),o(ra),d("div",A,[d("div",R,[o(y,{name:"mail"}),e[9]||(e[9]=d("span",null,"邮箱",-1))]),d("div",$,[va.value?(t(),u(ua,{key:1,modelValue:ma.value.email,"onUpdate:modelValue":e[1]||(e[1]=a=>ma.value.email=a),placeholder:"请输入邮箱",style:{width:"300px"}},null,8,["modelValue"])):(t(),i("span",D,n((null==(f=ca.value)?void 0:f.email)||"未设置"),1)),va.value?(t(),u(za,{key:3,size:"small"},{default:c(()=>[o(Pa,{theme:"primary",size:"small",onClick:Ca},{default:c(()=>[...e[11]||(e[11]=[v("保存",-1)])]),_:1}),o(Pa,{theme:"default",size:"small",onClick:ka},{default:c(()=>[...e[12]||(e[12]=[v("取消",-1)])]),_:1})]),_:1})):(t(),u(Pa,{key:2,theme:"default",size:"small",onClick:_a},{default:c(()=>[...e[10]||(e[10]=[v(" 修改 ",-1)])]),_:1}))])]),d("div",E,[d("div",F,[o(y,{name:"time"}),e[13]||(e[13]=d("span",null,"注册时间",-1))]),d("div",I,n(ba(null==(g=ca.value)?void 0:g.created_at)),1)]),d("div",L,[d("div",M,[o(y,{name:"login"}),e[14]||(e[14]=d("span",null,"最后登录",-1))]),d("div",N,n(ba(null==(w=ca.value)?void 0:w.last_login)),1)]),d("div",O,[d("div",Q,[o(y,{name:"chart-line"}),e[15]||(e[15]=d("span",null,"登录次数",-1))]),d("div",S,n((null==(h=ca.value)?void 0:h.login_count)||0)+" 次 ",1)])])]),d("div",T,[d("div",Y,[o(y,{name:"lock-on"}),e[16]||(e[16]=d("span",null,"安全设置",-1))]),d("div",Z,[d("div",{class:"security-item",onClick:xa},[d("div",B,[o(y,{name:"secured",class:"item-icon"}),e[17]||(e[17]=d("div",{class:"item-info"},[d("div",{class:"item-title"},"修改密码"),d("div",{class:"item-desc"},"定期修改密码可以提高账号安全性")],-1))]),o(y,{name:"chevron-right"})])])]),d("div",G,[d("div",H,[o(y,{name:"chart-pie"}),e[18]||(e[18]=d("span",null,"我的统计",-1))]),d("div",J,[d("div",K,[d("div",W,[o(y,{name:"lock-on",size:"24px"})]),d("div",X,[d("div",aa,n(wa.value.secretCount),1),e[19]||(e[19]=d("div",{class:"stat-label"},"密钥数量",-1))])]),d("div",ea,[d("div",la,[o(y,{name:"folder",size:"24px"})]),d("div",sa,[d("div",ta,n(wa.value.categoryCount),1),e[20]||(e[20]=d("div",{class:"stat-label"},"分类数量",-1))])]),d("div",ia,[d("div",da,[o(y,{name:"tag",size:"24px"})]),d("div",oa,[d("div",na,n(wa.value.tagCount),1),e[21]||(e[21]=d("div",{class:"stat-label"},"标签数量",-1))])])])])]),o(Aa,{visible:pa.value,"onUpdate:visible":e[5]||(e[5]=a=>pa.value=a),header:"修改密码",width:"500px","confirm-btn":{content:"确定",theme:"primary",loading:fa.value},"cancel-btn":{content:"取消"},onConfirm:Va},{default:c(()=>[o(Ua,{ref_key:"passwordFormRef",ref:ga,data:ha.value,rules:ya,"label-width":"80px"},{default:c(()=>[o(ja,{label:"旧密码",name:"oldPassword"},{default:c(()=>[o(ua,{modelValue:ha.value.oldPassword,"onUpdate:modelValue":e[2]||(e[2]=a=>ha.value.oldPassword=a),type:"password",placeholder:"请输入当前密码",clearable:""},null,8,["modelValue"])]),_:1}),o(ja,{label:"新密码",name:"newPassword"},{default:c(()=>[o(ua,{modelValue:ha.value.newPassword,"onUpdate:modelValue":e[3]||(e[3]=a=>ha.value.newPassword=a),type:"password",placeholder:"至少6个字符",clearable:""},null,8,["modelValue"])]),_:1}),o(ja,{label:"确认密码",name:"confirmPassword"},{default:c(()=>[o(ua,{modelValue:ha.value.confirmPassword,"onUpdate:modelValue":e[4]||(e[4]=a=>ha.value.confirmPassword=a),type:"password",placeholder:"再次输入新密码",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["data"]),o(qa,{theme:"info",message:"温馨提示：修改密码后需要重新登录",style:{"margin-top":"16px"}})]),_:1},8,["visible","confirm-btn"])])}}},[["__scopeId","data-v-3de13333"]]);export{ra as default};
