import{u as W,b as X,r as m,o as Y,d as r,e as g,f as S,g as s,h as t,t as c,m as Z,i as C,w as u,M as w,l as k}from"./index-82da048e.js";import{u as V,s as ss,e as es,t as ts}from"./index-e7daf545.js";import{_ as as}from"./_plugin-vue_export-helper-c27b6911.js";const os={class:"profile-page"},ls={class:"header"},ns={class:"header-content"},is={class:"profile-content app-container"},ds={class:"info-section"},rs={class:"section-title"},cs={class:"info-card app-card"},us={class:"avatar-section"},ms={class:"avatar"},vs={class:"user-info"},_s={class:"username"},ps={class:"info-item"},fs={class:"item-label"},gs={class:"item-value"},ws={key:0},hs={class:"info-item"},ys={class:"item-label"},bs={class:"item-value"},Ps={class:"info-item"},Cs={class:"item-label"},ks={class:"item-value"},Vs={class:"info-item"},xs={class:"item-label"},zs={class:"item-value"},Us={class:"security-section"},As={class:"section-title"},Es={class:"security-card app-card"},Rs={class:"item-left"},Bs={class:"stats-section"},Ds={class:"section-title"},Fs={class:"stats-grid"},Ns={class:"stat-card"},Ss={class:"stat-icon",style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}},qs={class:"stat-info"},Ms={class:"stat-value"},Ls={class:"stat-card"},Ts={class:"stat-icon",style:{background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"}},$s={class:"stat-info"},Is={class:"stat-value"},js={class:"stat-card"},Gs={class:"stat-icon",style:{background:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"}},Hs={class:"stat-info"},Js={class:"stat-value"},Ks={__name:"Profile",setup(Os){const q=W(),M=X(),n=m(null),p=m(!1),v=m({email:""}),h=m(!1),b=m(!1),x=m(null),y=m({secretCount:0,categoryCount:0,tagCount:0}),l=m({oldPassword:"",newPassword:"",confirmPassword:""}),L={oldPassword:[{required:!0,message:"请输入旧密码"}],newPassword:[{required:!0,message:"请输入新密码"},{min:6,message:"密码至少6个字符"}],confirmPassword:[{required:!0,message:"请再次输入新密码"},{validator:a=>a===l.value.newPassword,message:"两次输入的密码不一致"}]},z=a=>a?new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"未知",U=async()=>{try{const a=await V.getCurrentUser();a.data.success&&(n.value=a.data.data,v.value.email=a.data.data.email||"")}catch(a){console.error("获取用户信息失败:",a),w.error("获取用户信息失败")}},T=async()=>{var a,e,o;try{const[d,_,f]=await Promise.all([ss.getAll(),es.getAll(),ts.getAll()]);y.value={secretCount:((a=d.data.data)==null?void 0:a.length)||0,categoryCount:((e=_.data.data)==null?void 0:e.length)||0,tagCount:((o=f.data.data)==null?void 0:o.length)||0}}catch(d){console.error("获取统计信息失败:",d)}},$=()=>{var a;p.value=!0,v.value.email=((a=n.value)==null?void 0:a.email)||""},I=()=>{var a;p.value=!1,v.value.email=((a=n.value)==null?void 0:a.email)||""},j=async()=>{var a,e;try{(await V.updateProfile({email:v.value.email})).data.success&&(w.success("邮箱更新成功"),p.value=!1,await U())}catch(o){console.error("更新邮箱失败:",o),w.error(((e=(a=o.response)==null?void 0:a.data)==null?void 0:e.message)||"更新邮箱失败")}},G=()=>{l.value={oldPassword:"",newPassword:"",confirmPassword:""},h.value=!0},H=async()=>{var e,o;if(await x.value.validate()){b.value=!0;try{(await V.changePassword({oldPassword:l.value.oldPassword,newPassword:l.value.newPassword})).data.success&&(w.success("密码修改成功，请重新登录"),h.value=!1,setTimeout(()=>{M.logout(),q.push("/login")},1500))}catch(d){console.error("修改密码失败:",d),w.error(((o=(e=d.response)==null?void 0:e.data)==null?void 0:o.message)||"修改密码失败")}finally{b.value=!1}}};return Y(()=>{U(),T()}),(a,e)=>{var A,E,R,B,D,F,N;const o=r("t-icon"),d=r("t-divider"),_=r("t-input"),f=r("t-button"),J=r("t-space"),P=r("t-form-item"),K=r("t-form"),O=r("t-alert"),Q=r("t-dialog");return g(),S("div",os,[s("div",ls,[s("div",ns,[s("div",{class:"back-btn",onClick:e[0]||(e[0]=i=>a.$router.back())},[t(o,{name:"chevron-left",size:"20px"}),e[6]||(e[6]=s("span",null,"返回",-1))]),e[7]||(e[7]=s("h1",null,"个人中心",-1))])]),s("div",is,[s("div",ds,[s("div",rs,[t(o,{name:"user"}),e[8]||(e[8]=s("span",null,"基本信息",-1))]),s("div",cs,[s("div",us,[s("div",ms,[t(o,{name:"user",size:"40px"})]),s("div",vs,[s("div",_s,c((A=n.value)==null?void 0:A.username),1),s("div",{class:Z(["role-badge",(E=n.value)==null?void 0:E.role])},c(((R=n.value)==null?void 0:R.role)==="admin"?"管理员":"普通用户"),3)])]),t(d),s("div",ps,[s("div",fs,[t(o,{name:"mail"}),e[9]||(e[9]=s("span",null,"邮箱",-1))]),s("div",gs,[p.value?(g(),C(_,{key:1,modelValue:v.value.email,"onUpdate:modelValue":e[1]||(e[1]=i=>v.value.email=i),placeholder:"请输入邮箱",style:{width:"300px"}},null,8,["modelValue"])):(g(),S("span",ws,c(((B=n.value)==null?void 0:B.email)||"未设置"),1)),p.value?(g(),C(J,{key:3,size:"small"},{default:u(()=>[t(f,{theme:"primary",size:"small",onClick:j},{default:u(()=>[...e[11]||(e[11]=[k("保存",-1)])]),_:1}),t(f,{theme:"default",size:"small",onClick:I},{default:u(()=>[...e[12]||(e[12]=[k("取消",-1)])]),_:1})]),_:1})):(g(),C(f,{key:2,theme:"default",size:"small",onClick:$},{default:u(()=>[...e[10]||(e[10]=[k(" 修改 ",-1)])]),_:1}))])]),s("div",hs,[s("div",ys,[t(o,{name:"time"}),e[13]||(e[13]=s("span",null,"注册时间",-1))]),s("div",bs,c(z((D=n.value)==null?void 0:D.created_at)),1)]),s("div",Ps,[s("div",Cs,[t(o,{name:"login"}),e[14]||(e[14]=s("span",null,"最后登录",-1))]),s("div",ks,c(z((F=n.value)==null?void 0:F.last_login)),1)]),s("div",Vs,[s("div",xs,[t(o,{name:"chart-line"}),e[15]||(e[15]=s("span",null,"登录次数",-1))]),s("div",zs,c(((N=n.value)==null?void 0:N.login_count)||0)+" 次 ",1)])])]),s("div",Us,[s("div",As,[t(o,{name:"lock-on"}),e[16]||(e[16]=s("span",null,"安全设置",-1))]),s("div",Es,[s("div",{class:"security-item",onClick:G},[s("div",Rs,[t(o,{name:"secured",class:"item-icon"}),e[17]||(e[17]=s("div",{class:"item-info"},[s("div",{class:"item-title"},"修改密码"),s("div",{class:"item-desc"},"定期修改密码可以提高账号安全性")],-1))]),t(o,{name:"chevron-right"})])])]),s("div",Bs,[s("div",Ds,[t(o,{name:"chart-pie"}),e[18]||(e[18]=s("span",null,"我的统计",-1))]),s("div",Fs,[s("div",Ns,[s("div",Ss,[t(o,{name:"lock-on",size:"24px"})]),s("div",qs,[s("div",Ms,c(y.value.secretCount),1),e[19]||(e[19]=s("div",{class:"stat-label"},"密钥数量",-1))])]),s("div",Ls,[s("div",Ts,[t(o,{name:"folder",size:"24px"})]),s("div",$s,[s("div",Is,c(y.value.categoryCount),1),e[20]||(e[20]=s("div",{class:"stat-label"},"分类数量",-1))])]),s("div",js,[s("div",Gs,[t(o,{name:"tag",size:"24px"})]),s("div",Hs,[s("div",Js,c(y.value.tagCount),1),e[21]||(e[21]=s("div",{class:"stat-label"},"标签数量",-1))])])])])]),t(Q,{visible:h.value,"onUpdate:visible":e[5]||(e[5]=i=>h.value=i),header:"修改密码",width:"500px","confirm-btn":{content:"确定",theme:"primary",loading:b.value},"cancel-btn":{content:"取消"},onConfirm:H},{default:u(()=>[t(K,{ref_key:"passwordFormRef",ref:x,data:l.value,rules:L,"label-width":"80px"},{default:u(()=>[t(P,{label:"旧密码",name:"oldPassword"},{default:u(()=>[t(_,{modelValue:l.value.oldPassword,"onUpdate:modelValue":e[2]||(e[2]=i=>l.value.oldPassword=i),type:"password",placeholder:"请输入当前密码",clearable:""},null,8,["modelValue"])]),_:1}),t(P,{label:"新密码",name:"newPassword"},{default:u(()=>[t(_,{modelValue:l.value.newPassword,"onUpdate:modelValue":e[3]||(e[3]=i=>l.value.newPassword=i),type:"password",placeholder:"至少6个字符",clearable:""},null,8,["modelValue"])]),_:1}),t(P,{label:"确认密码",name:"confirmPassword"},{default:u(()=>[t(_,{modelValue:l.value.confirmPassword,"onUpdate:modelValue":e[4]||(e[4]=i=>l.value.confirmPassword=i),type:"password",placeholder:"再次输入新密码",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["data"]),t(O,{theme:"info",message:"温馨提示：修改密码后需要重新登录",style:{"margin-top":"16px"}})]),_:1},8,["visible","confirm-btn"])])}}},Ys=as(Ks,[["__scopeId","data-v-d78ea164"]]);export{Ys as default};
