import{d as b}from"./index-DT9TBuYH.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as p,k as J,h as O,M as d,c as K,a as i,b as l,m as C,w as t,d as o,o as f,f as n,t as u,l as Q,D as R}from"./index-DNqqV_T_.js";const X={class:"api-keys-page"},Y={class:"page-header"},Z={class:"api-key-code"},ee={key:0},te={key:1,class:"text-secondary"},ae={class:"empty-state"},le={class:"empty-icon"},se={class:"new-key-container"},ie={class:"key-value"},oe={class:"full-api-key"},ne={style:{"margin-top":"24px","text-align":"right"}},re={__name:"ApiKeys",setup(de){const x=p(!1),A=p(!1),k=p([]),v=p(!1),y=p(!1),w=p(""),r=p({name:"",permissions:"read",expiresIn:""}),V=J(()=>window.innerWidth<768),$=[{colKey:"name",title:"名称",width:150},{colKey:"key_prefix",title:"密钥",width:180,cell:"key_prefix"},{colKey:"permissions",title:"权限",width:100,cell:"permissions"},{colKey:"is_active",title:"状态",width:80,cell:"is_active"},{colKey:"last_used_at",title:"最后使用",width:150,cell:"last_used_at"},{colKey:"expires_at",title:"过期时间",width:150,cell:"expires_at"},{colKey:"created_at",title:"创建时间",width:150,cell:"created_at"},{colKey:"operation",title:"操作",width:150,fixed:"right",cell:"operation"}];O(()=>{g()});async function g(){x.value=!0;try{const s=await b.getAll();s.data.success&&(k.value=s.data.data)}catch(s){console.error("加载API密钥失败:",s),d.error("加载API密钥失败")}finally{x.value=!1}}function D(){r.value={name:"",permissions:"read",expiresIn:""},v.value=!0}async function z(){if(!r.value.name){d.warning("请输入密钥名称");return}A.value=!0;try{const s=await b.create(r.value);s.data.success&&(d.success("API密钥创建成功"),w.value=s.data.data.apiKey,v.value=!1,y.value=!0,await g())}catch(s){console.error("创建API密钥失败:",s),d.error("创建API密钥失败")}finally{A.value=!1}}async function T(s){try{(await b.update(s.id,{isActive:!s.is_active})).data.success&&(d.success(s.is_active?"API密钥已禁用":"API密钥已启用"),await g())}catch(e){console.error("更新API密钥失败:",e),d.error("更新API密钥失败")}}async function E(s){if(await R.confirm({header:"确认删除",body:`确定要删除API密钥"${s.name}"吗？此操作不可恢复。`,theme:"warning"}))try{(await b.delete(s.id)).data.success&&(d.success("API密钥删除成功"),await g())}catch(c){console.error("删除API密钥失败:",c),d.error("删除API密钥失败")}}function F(){navigator.clipboard.writeText(w.value).then(()=>{d.success("API密钥已复制到剪贴板")}).catch(()=>{d.error("复制失败，请手动复制")})}function I(s){return s?new Date(s).toLocaleString("zh-CN"):"-"}function q(s){return s?new Date(s)<new Date:!1}return(s,e)=>{const c=o("t-icon"),m=o("t-button"),N=o("t-alert"),h=o("t-tag"),L=o("t-space"),S=o("t-table"),U=o("t-card"),W=o("t-input"),P=o("t-form-item"),_=o("t-option"),B=o("t-select"),j=o("t-form"),M=o("t-dialog");return f(),K("div",X,[i("div",Y,[e[7]||(e[7]=i("div",null,[i("h3",null,"API密钥管理"),i("p",{class:"header-desc"},"创建API密钥用于第三方应用集成")],-1)),l(m,{theme:"primary",onClick:D},{icon:t(()=>[l(c,{name:"add"})]),default:t(()=>[e[6]||(e[6]=n(" 创建API密钥 ",-1))]),_:1})]),l(N,{theme:"info",style:{"margin-bottom":"24px"}},{message:t(()=>[...e[8]||(e[8]=[i("strong",null,"使用说明：",-1),i("ul",{style:{margin:"8px 0","padding-left":"20px"}},[i("li",null,"API密钥用于第三方应用访问您的2FA数据"),i("li",null,"创建后请妥善保管，密钥只显示一次"),i("li",null,"可以设置权限（只读/读写）和过期时间"),i("li",null,"请勿将密钥分享给不信任的第三方")],-1)])]),_:1}),k.value.length>0?(f(),C(U,{key:0},{default:t(()=>[l(S,{data:k.value,columns:$,loading:x.value,"row-key":"id",bordered:"",stripe:""},{key_prefix:t(({row:a})=>[i("code",Z,u(a.key_prefix),1)]),permissions:t(({row:a})=>[l(h,{theme:a.permissions==="read"?"success":"warning"},{default:t(()=>[n(u(a.permissions==="read"?"只读":"读写"),1)]),_:2},1032,["theme"])]),is_active:t(({row:a})=>[l(h,{theme:a.is_active?"success":"default"},{default:t(()=>[n(u(a.is_active?"启用":"禁用"),1)]),_:2},1032,["theme"])]),last_used_at:t(({row:a})=>[n(u(a.last_used_at?I(a.last_used_at):"从未使用"),1)]),expires_at:t(({row:a})=>[a.expires_at?(f(),K("span",ee,[n(u(I(a.expires_at))+" ",1),q(a.expires_at)?(f(),C(h,{key:0,theme:"danger",size:"small"},{default:t(()=>[...e[9]||(e[9]=[n("已过期",-1)])]),_:1})):Q("",!0)])):(f(),K("span",te,"永不过期"))]),created_at:t(({row:a})=>[n(u(I(a.created_at)),1)]),operation:t(({row:a})=>[l(L,null,{default:t(()=>[l(m,{size:"small",variant:"text",theme:"primary",onClick:G=>T(a)},{default:t(()=>[n(u(a.is_active?"禁用":"启用"),1)]),_:2},1032,["onClick"]),l(m,{size:"small",variant:"text",theme:"danger",onClick:G=>E(a)},{default:t(()=>[...e[10]||(e[10]=[n(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:1},8,["data","loading"])]),_:1})):(f(),C(U,{key:1,class:"empty-card"},{default:t(()=>[i("div",ae,[i("div",le,[l(c,{name:"key",size:"64px"})]),e[12]||(e[12]=i("h4",null,"暂无API密钥",-1)),e[13]||(e[13]=i("p",null,"创建您的第一个API密钥以开始使用第三方集成",-1)),l(m,{theme:"primary",onClick:D},{icon:t(()=>[l(c,{name:"add"})]),default:t(()=>[e[11]||(e[11]=n(" 创建API密钥 ",-1))]),_:1})])]),_:1})),l(M,{visible:v.value,"onUpdate:visible":e[3]||(e[3]=a=>v.value=a),header:"创建API密钥",width:V.value?"90%":"500px",onConfirm:z,"confirm-btn":{loading:A.value}},{default:t(()=>[l(j,{data:r.value,onSubmit:z,"label-width":"100px"},{default:t(()=>[l(P,{label:"密钥名称",required:""},{default:t(()=>[l(W,{modelValue:r.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>r.value.name=a),placeholder:"例如：生产环境密钥"},null,8,["modelValue"])]),_:1}),l(P,{label:"权限"},{default:t(()=>[l(B,{modelValue:r.value.permissions,"onUpdate:modelValue":e[1]||(e[1]=a=>r.value.permissions=a)},{default:t(()=>[l(_,{value:"read",label:"只读（推荐）"}),l(_,{value:"write",label:"读写"})]),_:1},8,["modelValue"])]),_:1}),l(P,{label:"过期时间"},{default:t(()=>[l(B,{modelValue:r.value.expiresIn,"onUpdate:modelValue":e[2]||(e[2]=a=>r.value.expiresIn=a),placeholder:"选择过期时间"},{default:t(()=>[l(_,{value:"",label:"永不过期"}),l(_,{value:"30d",label:"30天后"}),l(_,{value:"90d",label:"90天后"}),l(_,{value:"1y",label:"1年后"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["data"])]),_:1},8,["visible","width","confirm-btn"]),l(M,{visible:y.value,"onUpdate:visible":e[5]||(e[5]=a=>y.value=a),header:"API密钥创建成功",width:V.value?"90%":"600px",footer:!1},{default:t(()=>[l(N,{theme:"warning",style:{"margin-bottom":"16px"}},{default:t(()=>[...e[14]||(e[14]=[n(" 请妥善保管此密钥，关闭后将无法再次查看完整密钥 ",-1)])]),_:1}),i("div",se,[e[16]||(e[16]=i("div",{class:"key-label"},"API密钥：",-1)),i("div",ie,[i("code",oe,u(w.value),1),l(m,{size:"small",onClick:F},{icon:t(()=>[l(c,{name:"file-copy"})]),default:t(()=>[e[15]||(e[15]=n(" 复制 ",-1))]),_:1})])]),i("div",ne,[l(m,{theme:"primary",onClick:e[4]||(e[4]=a=>y.value=!1)},{default:t(()=>[...e[17]||(e[17]=[n(" 我已保存，关闭 ",-1)])]),_:1})])]),_:1},8,["visible","width"])])}}},me=H(re,[["__scopeId","data-v-278bbcfe"]]);export{me as default};
