import{j as N,r as d,v as B,k as I,h as K,z as L,c as m,a as o,l as w,b as l,d as h,t as y,w as c,A as S,q as T,u as F,o as f,f as k,M as A}from"./index-DNqqV_T_.js";import{c as P,u as R}from"./index-DT9TBuYH.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";const j={class:"login-container"},D={class:"login-icon"},E={class:"login-subtitle"},G={class:"mode-switch"},H={class:"login-form"},J={key:0,class:"input-wrapper"},O={class:"input-wrapper"},Q={key:0,class:"password-hint"},W={key:0,class:"login-footer"},X={class:"login-footer"},Y={__name:"Login",setup(Z){const p=F(),u=B(),b=N(),n=d(!1),g=d(!1),r=d(null),a=d(!0),t=d({username:u.query.username||"",password:""});u.query.username&&(a.value=!1);const V=I(()=>(a.value||t.value.username.length>0)&&t.value.password.length>0);K(()=>{q()});const q=()=>{L(()=>{var s;if(!a.value&&!t.value.username){const e=document.querySelector('input[placeholder="用户名"]');e==null||e.focus()}else r.value&&((s=r.value.$el.querySelector("input"))==null||s.focus())})},x=()=>{var s;r.value&&((s=r.value.$el.querySelector("input"))==null||s.focus())},$=()=>{a.value=!a.value,t.value.password="",a.value||(t.value.username=u.query.username||""),q()},M=()=>{g.value=!0,setTimeout(()=>{g.value=!1},500)},z=async()=>{if(V.value){n.value=!0;try{if(a.value){const s=await P.login({username:"admin",password:t.value.password});if(s.data.success){b.login(s.data.data.token,s.data.data.user),A.success("登录成功");const e=u.query.redirect;e&&e!=="/login"&&e!=="/register"?p.push(e):p.push("/admin")}}else{const s=await R.login({username:t.value.username,password:t.value.password});if(s.data.success){b.login(s.data.data.token,s.data.data.user),A.success("登录成功");const e=u.query.redirect;e&&e!=="/login"&&e!=="/register"?p.push(e):p.push("/app")}}}catch(s){console.error("登录失败:",s),M(),t.value.password="",x()}finally{n.value=!1}}};return(s,e)=>{const _=h("t-icon"),v=h("t-button"),C=h("t-input");return f(),m("div",j,[o("div",{class:T(["login-box",{shake:g.value}])},[o("div",D,[l(_,{name:a.value?"secured":"user"},null,8,["name"])]),e[7]||(e[7]=o("h1",{class:"login-title"},"2FA Authenticator",-1)),o("p",E,y(a.value?"管理员登录":"用户登录"),1),o("div",G,[l(v,{variant:"text",size:"small",onClick:$,class:"switch-btn"},{default:c(()=>[l(_,{name:a.value?"user":"secured"},null,8,["name"]),o("span",null,"切换到"+y(a.value?"用户":"管理员")+"登录",1)]),_:1})]),o("div",H,[a.value?w("",!0):(f(),m("div",J,[l(C,{modelValue:t.value.username,"onUpdate:modelValue":e[0]||(e[0]=i=>t.value.username=i),size:"large",placeholder:"用户名",disabled:n.value,onKeyup:S(x,["enter"])},{"prefix-icon":c(()=>[l(_,{name:"user"})]),_:1},8,["modelValue","disabled"])])),o("div",O,[l(C,{ref_key:"passwordInput",ref:r,modelValue:t.value.password,"onUpdate:modelValue":e[1]||(e[1]=i=>t.value.password=i),type:"password",size:"large",placeholder:a.value?"管理员密码":"密码",onKeyup:S(z,["enter"]),disabled:n.value},null,8,["modelValue","placeholder","disabled"]),a.value?(f(),m("div",Q,"请输入管理员密码")):w("",!0)]),l(v,{theme:"primary",size:"large",block:"",loading:n.value,disabled:!V.value,onClick:z,class:"login-button"},{default:c(()=>[k(y(n.value?"登录中...":"登录"),1)]),_:1},8,["loading","disabled"])]),a.value?w("",!0):(f(),m("div",W,[e[5]||(e[5]=o("span",null,"还没有账号？",-1)),l(v,{variant:"text",size:"small",onClick:e[2]||(e[2]=i=>s.$router.push("/register"))},{default:c(()=>[...e[4]||(e[4]=[k(" 立即注册 ",-1)])]),_:1})])),o("div",X,[l(v,{variant:"text",size:"small",onClick:e[3]||(e[3]=i=>s.$router.push("/"))},{default:c(()=>[...e[6]||(e[6]=[k(" 返回首页 ",-1)])]),_:1})])],2)])}}},te=U(Y,[["__scopeId","data-v-a4668b9f"]]);export{te as default};
