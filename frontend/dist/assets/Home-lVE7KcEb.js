import{h as Oe,i as je,j as gt,r as d,k as B,c as m,a,l as y,b as l,d as b,m as D,w as i,t as v,F as P,g as G,M as r,u as _t,n as yt,o as c,f as z,p as ge,q as oe,s as ht,D as bt}from"./index-DNqqV_T_.js";import{s as I,u as kt,q as wt,b as Re,t as Me}from"./index-DT9TBuYH.js";import{_ as xt}from"./_plugin-vue_export-helper-DlAUqK2U.js";function Ct(g){const R=u=>{var $,U,K,L,k,M;if((u.ctrlKey||u.metaKey)&&u.key==="k"&&(u.preventDefault(),($=g.onSearch)==null||$.call(g)),(u.ctrlKey||u.metaKey)&&u.key==="n"&&(u.preventDefault(),(U=g.onNew)==null||U.call(g)),(u.ctrlKey||u.metaKey)&&u.key==="s"&&(u.preventDefault(),(K=g.onSave)==null||K.call(g)),(u.ctrlKey||u.metaKey)&&u.key==="l"&&(u.preventDefault(),(L=g.onLock)==null||L.call(g)),u.key==="Escape"&&((k=g.onEscape)==null||k.call(g)),/^[1-9]$/.test(u.key)&&(u.ctrlKey||u.metaKey)){u.preventDefault();const V=parseInt(u.key)-1;(M=g.onQuickCopy)==null||M.call(g,V)}};Oe(()=>{document.addEventListener("keydown",R)}),je(()=>{document.removeEventListener("keydown",R)})}const Dt={class:"home"},zt={class:"header"},Vt={class:"header-container"},St={class:"header-left"},Tt={class:"brand-logo"},Lt={class:"logo-icon"},Ut={class:"header-right"},At={class:"user-name"},Ft={class:"header-center"},$t={key:0,class:"batch-toolbar"},Et={class:"batch-toolbar-left"},It={class:"selected-count"},Rt={class:"batch-toolbar-right"},Mt={class:"main-content"},Ot={key:0,class:"favorites-bar"},jt={class:"favorites-header"},Bt={class:"favorites-list"},Kt=["onClick","title"],qt={class:"favorite-info"},Nt={class:"favorite-name"},Pt={class:"favorite-token"},Gt={key:1,class:"empty-state"},Jt={class:"empty-icon"},Qt={class:"empty-title"},Wt={class:"empty-desc"},Ht={key:3,class:"table-container desktop-view"},Xt={class:"secret-table"},Yt={key:0,class:"checkbox-col"},Zt={key:0,class:"checkbox-cell"},ea={class:"icon-cell"},ta={class:"name-cell"},aa={class:"name-wrapper"},sa={class:"secret-name"},oa={class:"issuer-cell"},la={class:"issuer"},na={class:"note-cell"},ia=["title"],ra={class:"secret-key-cell"},ca={class:"secret-key-wrapper"},ua={class:"secret-key-text"},da={class:"secret-key-actions"},va={class:"code-cell"},ma=["onClick","title"],pa={class:"timer-cell"},fa={class:"timer-wrapper"},ga={class:"timer-text"},_a={class:"action-cell"},ya={key:1,style:{color:"#999"}},ha={key:4,class:"mobile-view"},ba={class:"mobile-card-header"},ka={class:"mobile-card-title"},wa={class:"mobile-name"},xa={class:"mobile-issuer"},Ca={key:0,class:"mobile-card-note"},Da={class:"mobile-note-text"},za={class:"mobile-card-secret"},Va={class:"mobile-secret-value"},Sa={class:"mobile-secret-text"},Ta={class:"mobile-secret-actions"},La={class:"mobile-card-code"},Ua={class:"mobile-code-display"},Aa={class:"mobile-card-timer"},Fa={class:"mobile-timer-text"},$a={key:5,class:"footer-stats"},Ea={class:"stat-item"},Ia={key:0,class:"stat-item"},Ra={class:"stat-item"},Ma={class:"template-dialog"},Oa={class:"template-header"},ja={class:"template-list"},Ba=["onClick"],Ka={class:"template-icon"},qa={class:"template-info"},Na={class:"template-name"},Pa={class:"template-desc"},Ga={key:0,class:"template-empty"},Ja={style:{"text-align":"center"}},Qa={key:0,style:{"margin-bottom":"16px"}},Wa=["src"],Ha={__name:"Home",setup(g){const R=_t(),u=gt(),$=d(null),U=d(window.innerWidth<=768),K=()=>{U.value=window.innerWidth<=768},L=d(!1),k=d([]),M=d({}),V=d(30),A=d(""),p=d([]),x=d(!1),F=d([]),le=d(null),_e=B(()=>k.value.filter(t=>t.is_favorite).slice(0,5)),E=d(!1),J=d("添加密钥"),_=d({name:"",secret_key:"",issuer:"",note:""}),Q=d(!1),ne=d("merge"),W=d(null),H=d(!1),ye=d([]),he=d([]),X=d(""),Y=d(""),ie=d(!1),be=B(()=>{let t=ye.value;if(Y.value&&(t=t.filter(e=>e.category===Y.value)),X.value){const e=X.value.toLowerCase();t=t.filter(o=>o.name.toLowerCase().includes(e)||o.issuer.toLowerCase().includes(e)||o.description.toLowerCase().includes(e))}return t}),Be=[{content:"导出数据",value:"export"},{content:"导入数据",value:"import"},{content:"设置",value:"settings"}],Ke=B(()=>{var e;const t=[{content:"个人资料",value:"profile",prefixIcon:"user"},{content:"修改密码",value:"change-password",prefixIcon:"lock-on"}];return((e=$.value)==null?void 0:e.role)==="admin"&&t.push({content:"管理后台",value:"admin",prefixIcon:"dashboard"}),t.push({content:"退出登录",value:"logout",prefixIcon:"poweroff",theme:"danger"}),t}),ke=t=>[{content:"编辑",value:"edit"},{content:t.is_favorite?"取消收藏":"收藏",value:"favorite"},{content:"删除",value:"delete",theme:"danger"}],we=B({get:()=>p.value.length===C.value.length&&C.value.length>0,set:t=>{t?p.value=C.value.map(e=>e.id):p.value=[]}}),Z=B(()=>V.value/30*100),C=B(()=>{let t=k.value;if(A.value){const e=A.value.toLowerCase();t=t.filter(o=>o.name.toLowerCase().includes(e)||o.issuer&&o.issuer.toLowerCase().includes(e)||o.note&&o.note.toLowerCase().includes(e))}return t.sort((e,o)=>e.is_favorite&&!o.is_favorite?-1:!e.is_favorite&&o.is_favorite?1:0)}),xe={github:"🔵",google:"🔴",microsoft:"🟢",apple:"⚫",facebook:"🔵",twitter:"🔵",amazon:"🟠",aws:"🟠",azure:"🔵",steam:"⚫",discord:"🟣",telegram:"🔵",dropbox:"🔵",gitlab:"🟠",default:"🔐"},Ce={github:"#181717",google:"#4285F4",microsoft:"#00A4EF",apple:"#000000",facebook:"#1877F2",twitter:"#1DA1F2",amazon:"#FF9900",aws:"#FF9900",azure:"#0078D4",steam:"#171A21",discord:"#5865F2",telegram:"#26A5E4",dropbox:"#0061FF",gitlab:"#FC6D26",default:"#1890ff"},re=t=>{const e=(t.name+" "+(t.issuer||"")).toLowerCase();for(const[o,n]of Object.entries(xe))if(e.includes(o))return n;return xe.default},ce=t=>{const e=(t.name+" "+(t.issuer||"")).toLowerCase();for(const[o,n]of Object.entries(Ce))if(e.includes(o))return n;return Ce.default},O=async()=>{var t,e,o;L.value=!0;try{const n=await I.getAll();if(!Array.isArray(n.data.data))throw new Error("数据格式错误");const f=n.data.data.filter(h=>!h.id||!h.name||!h.secret_key?(console.warn("发现无效密钥:",h),!1):!0);f.length<n.data.data.length&&r.warning(`发现 ${n.data.data.length-f.length} 个无效密钥已被过滤`),k.value=f}catch(n){((t=n.response)==null?void 0:t.status)===401?k.value=[]:((e=n.response)==null?void 0:e.status)===403?(r.error("权限不足，无法加载数据"),k.value=[]):((o=n.response)==null?void 0:o.status)>=500?(r.error("服务器错误，请稍后重试"),k.value=[]):!n.response&&n.request?k.value=[]:(r.error(n.message||"加载失败，请刷新重试"),k.value=[])}finally{L.value=!1}},q=async()=>{var t;try{const e=await I.getAllTokens(),o={};e.data.data.forEach(n=>{o[n.id]=n.token}),M.value=o,V.value=((t=e.data.data[0])==null?void 0:t.remaining)||30}catch{}},ue=t=>M.value[t]||"------",de=t=>t==="------"?t:t.slice(0,3)+" "+t.slice(3),ee=async t=>{const e=M.value[t];if(e&&e!=="------")try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(e),r.success("验证码已复制（30秒后自动清除）");else{const o=document.createElement("textarea");o.value=e,o.style.position="fixed",o.style.opacity="0",document.body.appendChild(o),o.select();try{if(document.execCommand("copy"))r.success("验证码已复制（30秒后自动清除）");else throw new Error("复制命令执行失败")}finally{document.body.removeChild(o)}}le.value=t,setTimeout(()=>{le.value=null},1e3),setTimeout(async()=>{try{navigator.clipboard&&navigator.clipboard.readText&&await navigator.clipboard.readText()===e&&await navigator.clipboard.writeText("")}catch{}},3e4)}catch(o){r.error("复制失败："+o.message)}else r.warning("验证码还未生成，请稍候")},ve=()=>{J.value="添加密钥",_.value={name:"",secret_key:"",issuer:"",note:""},E.value=!0},qe=async()=>{await Ne(),await Pe(),H.value=!0};async function Ne(){ie.value=!0;try{const t=await Me.getAllTemplates();t.data.success&&(ye.value=t.data.data.templates||[])}catch(t){console.error("加载模板失败:",t),r.error("加载模板失败")}finally{ie.value=!1}}async function Pe(){try{const t=await Me.getCategories();t.data.success&&(he.value=t.data.data||[])}catch(t){console.error("加载分类失败:",t)}}function De(){}function Ge(t){J.value=`添加 ${t.name} 密钥`,_.value={name:t.name,secret_key:"",issuer:t.issuer,note:t.description},H.value=!1,E.value=!0}const N=d(!1),te=d(""),ze=d(null),ae=d(!1),Je=()=>{N.value=!0,te.value="",setTimeout(()=>{document.addEventListener("paste",me)},100)},Ve=()=>{document.removeEventListener("paste",me)},Qe=()=>{var t;(t=ze.value)==null||t.click()},We=t=>{const e=t.target.files[0];e&&pe(e)},He=t=>{t.preventDefault(),ae.value=!0},Xe=t=>{t.preventDefault(),ae.value=!1},Ye=t=>{t.preventDefault(),ae.value=!1;const e=t.dataTransfer.files[0];e&&e.type.startsWith("image/")?pe(e):r.warning("请拖拽图片文件")},me=t=>{var o;if(!N.value)return;const e=(o=t.clipboardData)==null?void 0:o.items;if(e){for(let n=0;n<e.length;n++)if(e[n].type.startsWith("image/")){const f=e[n].getAsFile();pe(f),t.preventDefault();break}}},pe=t=>{if(!t)return;if(!t.type.startsWith("image/")){r.error("请上传图片文件（JPG、PNG 等格式）");return}if(t.size>10*1024*1024){r.error("图片文件过大，请选择小于 10MB 的图片");return}const e=new FileReader;e.onload=async o=>{var n,f;try{te.value=o.target.result;const h=r.loading({content:"正在识别二维码，请稍候...",duration:0}),S=await wt.upload({image:o.target.result});if(h.close(),S.data.success){const T=S.data.data;if(console.log("解析结果:",T),!T.secret){r.error("二维码数据不完整，缺少密钥信息");return}_.value={name:T.name||T.issuer||"未命名",secret_key:T.secret,issuer:T.issuer||"",note:""},r.success({content:"✓ 二维码识别成功！",duration:2e3}),N.value=!1,E.value=!0,Ve()}}catch(h){r.close(),console.error("二维码处理错误:",h);const S=((f=(n=h.response)==null?void 0:n.data)==null?void 0:f.message)||h.message;S.includes("未能识别")||S.includes("未找到")?r.error({content:`❌ 未能识别到二维码

💡 请确保：
• 图片清晰完整
• 包含完整的二维码
• 光线充足、无反光
• 尝试放大后截图`,duration:5e3}):S.includes("otpauth")?r.error({content:`❌ 二维码格式不正确

💡 请使用：
• Google Authenticator
• Microsoft Authenticator
• 其他标准 TOTP 应用的二维码`,duration:5e3}):r.error({content:`二维码解析失败

原因：`+S,duration:4e3})}},e.onerror=()=>{r.error("图片读取失败，请确保文件未损坏")},e.readAsDataURL(t)},Ze=async()=>{var t,e;if(!_.value.name||!_.value.secret_key){r.warning("请填写名称和密钥");return}try{_.value.id?(await I.update(_.value.id,_.value),r.success("更新成功")):(await I.create(_.value),r.success("添加成功")),O(),q(),E.value=!1}catch(o){r.error(((e=(t=o.response)==null?void 0:t.data)==null?void 0:e.message)||"操作失败")}},Se=async(t,e)=>{switch(t.value){case"edit":J.value="编辑密钥",_.value={...e},E.value=!0;break;case"favorite":try{await I.toggleFavorite(e.id),O(),r.success(e.is_favorite?"已取消收藏":"已收藏")}catch{r.error("操作失败")}break;case"delete":try{await I.delete(e.id),r.success("删除成功"),O()}catch{r.error("删除失败")}break}},Te=async t=>{switch(t.value){case"export":try{const e=await Re.export(),o=new Blob([JSON.stringify(e.data.data,null,2)],{type:"application/json"}),n=URL.createObjectURL(o),f=document.createElement("a");f.href=n,f.download=`2fa-backup-${Date.now()}.json`,f.click(),URL.revokeObjectURL(n),localStorage.setItem("last_backup_time",Date.now().toString()),r.success("导出成功")}catch{r.error("导出失败")}break;case"import":Q.value=!0;break;case"settings":R.push("/settings");break}},et=async t=>{switch(t.value){case"profile":r.info("个人资料功能开发中...");break;case"change-password":r.info("修改密码功能开发中...");break;case"admin":R.push("/admin");break;case"logout":await bt.confirm({header:"退出登录",body:"确定要退出登录吗？",confirmBtn:"退出",cancelBtn:"取消"})&&(u.logout(),r.success("已退出登录"),R.push("/"));break}},tt=async()=>{if(u.authToken)try{const t=await kt.getCurrentUser();t.data.success&&($.value=t.data.data)}catch(t){console.error("获取用户信息失败:",t)}},Le=t=>{const e=F.value.indexOf(t);e>-1?F.value.splice(e,1):F.value.push(t)},Ue=async t=>{try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(t),r.success("密钥已复制到剪贴板");else{const e=document.createElement("textarea");e.value=t,e.style.position="fixed",e.style.opacity="0",document.body.appendChild(e),e.select();try{if(document.execCommand("copy"))r.success("密钥已复制到剪贴板");else throw new Error("复制命令执行失败")}finally{document.body.removeChild(e)}}}catch(e){r.error("复制失败："+e.message)}},at=()=>{x.value=!0,p.value=[]},Ae=()=>{x.value=!1,p.value=[]},Fe=t=>{const e=p.value.indexOf(t);e>-1?p.value.splice(e,1):p.value.push(t)},st=t=>{t?p.value=C.value.map(e=>e.id):p.value=[]},ot=async()=>{var e,o;if(p.value.length===0){r.warning("请先选择要删除的密钥");return}if(confirm(`确定要删除选中的 ${p.value.length} 个密钥吗？此操作不可恢复！`))try{await I.batchDelete(p.value),r.success(`成功删除 ${p.value.length} 个密钥`),O(),q(),Ae()}catch(n){r.error("批量删除失败："+(((o=(e=n.response)==null?void 0:e.data)==null?void 0:o.message)||n.message))}},lt=()=>{if(p.value.length===0){r.warning("请先选择要导出的密钥");return}try{const t=k.value.filter(h=>p.value.includes(h.id)),e={version:"2.0.0",timestamp:new Date().toISOString(),count:t.length,secrets:t},o=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(o),f=document.createElement("a");f.href=n,f.download=`2fa-selected-${t.length}-${Date.now()}.json`,f.click(),URL.revokeObjectURL(n),r.success(`成功导出 ${t.length} 个密钥`)}catch(t){r.error("导出失败："+t.message)}},nt=t=>{W.value=t.target.files[0]},it=async()=>{if(!W.value){r.warning("请选择文件");return}try{const t=await W.value.text(),e=JSON.parse(t);await Re.import({categories:e.categories,secrets:e.secrets,merge:ne.value==="merge"}),r.success("导入成功"),O(),q(),Q.value=!1}catch(t){r.error("导入失败："+t.message)}};Ct({onSearch:()=>{var t;return(t=document.querySelector(".search-input input"))==null?void 0:t.focus()},onNew:ve});const rt=()=>{const t=localStorage.getItem("last_backup_time");if(!t)return;const e=(Date.now()-parseInt(t))/(1e3*60*60*24);e>7&&setTimeout(()=>{r.warning({content:`您已经 ${Math.floor(e)} 天没有备份数据了，建议立即备份`,duration:8e3})},2e3)};let fe=null;return Oe(()=>{(u.isAuthenticated||u.authToken)&&(O(),q(),tt()),rt(),fe=setInterval(()=>{k.value.length>0&&u.isAuthenticated&&(V.value--,V.value<=0&&q())},1e3),window.addEventListener("resize",K)}),je(()=>{fe&&clearInterval(fe),window.removeEventListener("resize",K),document.removeEventListener("paste",me)}),(t,e)=>{const o=b("t-icon"),n=b("t-button"),f=b("t-dropdown"),h=b("t-input"),S=b("t-checkbox"),T=b("t-space"),ct=b("t-loading"),$e=b("t-progress"),j=b("t-form-item"),ut=b("t-textarea"),Ee=b("t-form"),se=b("t-dialog"),Ie=b("t-radio"),dt=b("t-radio-group"),vt=b("t-option"),mt=b("t-select"),pt=b("t-tag"),ft=yt("loading");return c(),m("div",Dt,[a("div",zt,[a("div",Vt,[a("div",St,[a("div",Tt,[a("div",Lt,[l(o,{name:"secured",size:"22px"})]),e[14]||(e[14]=a("div",{class:"brand-info"},[a("span",{class:"brand-name"},"2FA Authenticator")],-1))])]),a("div",Ut,[x.value?y("",!0):(c(),D(n,{key:0,theme:"primary",onClick:ve,class:"action-btn"},{icon:i(()=>[l(o,{name:"add"})]),default:i(()=>[e[15]||(e[15]=a("span",{class:"btn-text"},"新建",-1))]),_:1})),!x.value&&C.value.length>0?(c(),D(n,{key:1,variant:"outline",onClick:at,class:"action-btn"},{icon:i(()=>[l(o,{name:"check-circle"})]),default:i(()=>[e[16]||(e[16]=a("span",{class:"btn-text"},"批量",-1))]),_:1})):y("",!0),x.value?(c(),D(n,{key:2,theme:"danger",onClick:Ae,class:"action-btn exit-batch-btn"},{default:i(()=>[e[17]||(e[17]=a("span",{class:"btn-text"},"退出批量",-1)),l(o,{name:"close",class:"btn-icon-only"})]),_:1})):y("",!0),x.value?y("",!0):(c(),D(f,{key:3,options:Be,onClick:Te},{default:i(()=>[l(n,{variant:"outline",shape:"circle",class:"icon-btn"},{default:i(()=>[l(o,{name:"ellipsis"})]),_:1})]),_:1})),!x.value&&$.value?(c(),D(f,{key:4,options:Ke.value,onClick:et},{default:i(()=>[l(n,{variant:"outline",class:"user-btn"},{default:i(()=>[l(o,{name:"user"}),a("span",At,v($.value.username),1)]),_:1})]),_:1},8,["options"])):y("",!0)]),a("div",Ft,[l(h,{modelValue:A.value,"onUpdate:modelValue":e[0]||(e[0]=s=>A.value=s),placeholder:U.value?"搜索...":"搜索密钥、发行商...",class:"search-input",clearable:""},{"prefix-icon":i(()=>[l(o,{name:"search"})]),_:1},8,["modelValue","placeholder"])])])]),x.value&&C.value.length>0?(c(),m("div",$t,[a("div",Et,[l(S,{modelValue:we.value,"onUpdate:modelValue":e[1]||(e[1]=s=>we.value=s),onChange:st},{default:i(()=>[...e[18]||(e[18]=[z(" 全选 ",-1)])]),_:1},8,["modelValue"]),a("span",It,"已选择 "+v(p.value.length)+" 项",1)]),a("div",Rt,[l(n,{theme:"primary",variant:"outline",disabled:p.value.length===0,onClick:lt},{icon:i(()=>[l(o,{name:"download"})]),default:i(()=>[e[19]||(e[19]=z(" 导出选中 ",-1))]),_:1},8,["disabled"]),l(n,{theme:"danger",disabled:p.value.length===0,onClick:ot},{icon:i(()=>[l(o,{name:"delete"})]),default:i(()=>[e[20]||(e[20]=z(" 删除选中 ",-1))]),_:1},8,["disabled"])])])):y("",!0),a("div",Mt,[!L.value&&_e.value.length>0?(c(),m("div",Ot,[a("div",jt,[l(o,{name:"star-filled",style:{color:"#faad14","margin-right":"8px"}}),e[21]||(e[21]=a("span",{class:"favorites-title"},"常用密钥",-1))]),a("div",Bt,[(c(!0),m(P,null,G(_e.value,s=>(c(),m("div",{key:s.id,class:"favorite-item",onClick:w=>ee(s.id),title:`点击复制 ${s.name} 的验证码`},[a("div",{class:"favorite-icon",style:ge({backgroundColor:ce(s)})},v(re(s)),5),a("div",qt,[a("div",Nt,v(s.name),1),a("div",Pt,v(de(ue(s.id))),1)])],8,Kt))),128))])])):y("",!0),!L.value&&C.value.length===0?(c(),m("div",Gt,[a("div",Jt,[l(o,{name:"secured",size:"80px"})]),a("h3",Qt,v(A.value?"没有找到匹配的密钥":"开始使用 2FA 笔记本"),1),a("p",Wt,v(A.value?"试试其他搜索关键词":"添加您的第一个两步验证密钥，保护账户安全"),1),A.value?y("",!0):(c(),D(T,{key:0,direction:"vertical",size:"large"},{default:i(()=>[l(T,null,{default:i(()=>[l(n,{theme:"primary",size:"large",onClick:ve},{icon:i(()=>[l(o,{name:"add"})]),default:i(()=>[e[22]||(e[22]=z(" 手动添加 ",-1))]),_:1}),l(n,{theme:"default",size:"large",onClick:qe},{icon:i(()=>[l(o,{name:"application"})]),default:i(()=>[e[23]||(e[23]=z(" 从模板选择 ",-1))]),_:1})]),_:1}),l(n,{variant:"text",size:"large",onClick:e[2]||(e[2]=s=>Te({value:"import"}))},{default:i(()=>[...e[24]||(e[24]=[z(" 或导入现有数据 ",-1)])]),_:1})]),_:1}))])):L.value?(c(),D(ct,{key:2,size:"large",text:"加载中..."})):(c(),m("div",Ht,[a("table",Xt,[a("thead",null,[a("tr",null,[x.value?(c(),m("th",Yt)):y("",!0),e[25]||(e[25]=a("th",{class:"icon-col"},null,-1)),e[26]||(e[26]=a("th",{class:"name-col"},"服务/名称",-1)),e[27]||(e[27]=a("th",{class:"issuer-col"},"发行者",-1)),e[28]||(e[28]=a("th",{class:"note-col"},"备注",-1)),e[29]||(e[29]=a("th",{class:"key-col"},"密钥",-1)),e[30]||(e[30]=a("th",{class:"code-col"},"验证码",-1)),e[31]||(e[31]=a("th",{class:"timer-col"},"剩余时间",-1)),e[32]||(e[32]=a("th",{class:"action-col"},"操作",-1))])]),a("tbody",null,[(c(!0),m(P,null,G(C.value,s=>(c(),m("tr",{key:s.id,class:oe(["secret-row",{"selected-row":p.value.includes(s.id)}])},[x.value?(c(),m("td",Zt,[l(S,{checked:p.value.includes(s.id),onChange:w=>Fe(s.id)},null,8,["checked","onChange"])])):y("",!0),a("td",ea,[a("div",{class:"service-icon",style:ge({backgroundColor:ce(s)})},v(re(s)),5)]),a("td",ta,[a("div",aa,[a("span",sa,v(s.name),1),s.is_favorite?(c(),D(o,{key:0,name:"star-filled",style:{color:"#faad14","margin-left":"8px"}})):y("",!0)])]),a("td",oa,[a("span",la,v(s.issuer||"-"),1)]),a("td",na,[a("span",{class:"note-text",title:s.note},v(s.note||"-"),9,ia)]),a("td",ra,[a("div",ca,[a("span",ua,v(F.value.includes(s.id)?s.secret_key:"••••••••••••••••"),1),a("div",da,[l(n,{size:"small",variant:"text",onClick:w=>Le(s.id),title:F.value.includes(s.id)?"隐藏密钥":"显示密钥"},{default:i(()=>[l(o,{name:F.value.includes(s.id)?"browse-off":"browse"},null,8,["name"])]),_:2},1032,["onClick","title"]),l(n,{size:"small",variant:"text",onClick:w=>Ue(s.secret_key),title:"复制密钥"},{default:i(()=>[l(o,{name:"file-copy"})]),_:1},8,["onClick"])])])]),a("td",va,[a("div",{class:oe(["code-display",{"code-expiring":V.value<=5,"copied-animation":le.value===s.id}]),onClick:w=>ee(s.id),title:V.value<=5?"验证码即将过期！":"点击复制验证码"},v(de(ue(s.id))),11,ma)]),a("td",pa,[a("div",fa,[l($e,{percentage:Z.value,"stroke-width":6,theme:Z.value>30?"success":"warning","show-label":!1,style:{width:"100px","margin-right":"8px"}},null,8,["percentage","theme"]),a("span",ga,v(V.value)+"s",1)])]),a("td",_a,[x.value?(c(),m("span",ya,"批量模式")):(c(),D(T,{key:0,size:"small"},{default:i(()=>[l(n,{size:"small",theme:"primary",variant:"outline",onClick:w=>ee(s.id)},{default:i(()=>[l(o,{name:"file-copy"})]),_:1},8,["onClick"]),l(f,{options:ke(s),onClick:w=>Se(w,s)},{default:i(()=>[l(n,{size:"small",variant:"outline"},{default:i(()=>[l(o,{name:"more"})]),_:1})]),_:1},8,["options","onClick"])]),_:2},1024))])],2))),128))])])])),!L.value&&C.value.length>0?(c(),m("div",ha,[(c(!0),m(P,null,G(C.value,s=>(c(),m("div",{key:s.id,class:oe(["mobile-card",{"selected-card":p.value.includes(s.id)}])},[a("div",ba,[x.value?(c(),D(S,{key:0,checked:p.value.includes(s.id),onChange:w=>Fe(s.id),style:{"margin-right":"12px"}},null,8,["checked","onChange"])):y("",!0),a("div",ka,[a("div",{class:"service-icon-mobile",style:ge({backgroundColor:ce(s)})},v(re(s)),5),a("div",null,[a("div",wa,[z(v(s.name)+" ",1),s.is_favorite?(c(),D(o,{key:0,name:"star-filled",style:{color:"#faad14","margin-left":"4px"},size:"14px"})):y("",!0)]),a("div",xa,v(s.issuer||"未设置发行者"),1)])]),l(f,{options:ke(s),onClick:w=>Se(w,s)},{default:i(()=>[l(n,{size:"small",variant:"text"},{default:i(()=>[l(o,{name:"more",size:"20px"})]),_:1})]),_:1},8,["options","onClick"])]),s.note?(c(),m("div",Ca,[l(o,{name:"chat",size:"14px",style:{color:"#999","margin-right":"4px"}}),a("span",Da,v(s.note),1)])):y("",!0),a("div",za,[e[33]||(e[33]=a("div",{class:"mobile-secret-label"},"密钥",-1)),a("div",Va,[a("span",Sa,v(F.value.includes(s.id)?s.secret_key:"••••••••••••••••"),1),a("div",Ta,[l(n,{size:"small",variant:"text",onClick:w=>Le(s.id)},{default:i(()=>[l(o,{name:F.value.includes(s.id)?"browse-off":"browse"},null,8,["name"])]),_:2},1032,["onClick"]),l(n,{size:"small",variant:"text",onClick:w=>Ue(s.secret_key)},{default:i(()=>[l(o,{name:"file-copy"})]),_:1},8,["onClick"])])])]),a("div",La,[a("div",Ua,v(de(ue(s.id))),1),l(n,{theme:"primary",size:"large",block:"",onClick:w=>ee(s.id)},{icon:i(()=>[l(o,{name:"file-copy"})]),default:i(()=>[e[34]||(e[34]=z(" 复制验证码 ",-1))]),_:1},8,["onClick"])]),a("div",Aa,[l($e,{percentage:Z.value,"stroke-width":4,theme:Z.value>30?"success":"warning","show-label":!1},null,8,["percentage","theme"]),a("span",Fa,v(V.value)+" 秒后刷新",1)])],2))),128))])):y("",!0),!L.value&&C.value.length>0?(c(),m("div",$a,[a("div",Ea,[l(o,{name:"key",size:"16px"}),a("span",null,"总计 "+v(k.value.length)+" 个密钥",1)]),A.value?(c(),m("div",Ia,[l(o,{name:"search",size:"16px"}),a("span",null,"筛选 "+v(C.value.length)+" 个",1)])):y("",!0),a("div",Ra,[l(o,{name:"refresh",size:"16px"}),a("span",null,v(V.value)+"秒后刷新",1)])])):y("",!0)]),l(se,{visible:E.value,"onUpdate:visible":e[7]||(e[7]=s=>E.value=s),header:J.value,width:U.value?"90%":"600px",onConfirm:Ze},{default:i(()=>[l(Ee,{data:_.value,"label-width":"80px"},{default:i(()=>[l(j,{label:"名称",required:""},{default:i(()=>[l(h,{modelValue:_.value.name,"onUpdate:modelValue":e[3]||(e[3]=s=>_.value.name=s),placeholder:"例如：GitHub"},null,8,["modelValue"])]),_:1}),l(j,{label:"密钥",required:""},{tips:i(()=>[l(T,{direction:"vertical",size:"4px"},{default:i(()=>[e[36]||(e[36]=a("span",null,"从服务商获取的密钥字符串",-1)),l(n,{size:"small",theme:"primary",variant:"text",onClick:Je},{default:i(()=>[...e[35]||(e[35]=[z(" 或者上传二维码图片 ",-1)])]),_:1})]),_:1})]),default:i(()=>[l(h,{modelValue:_.value.secret_key,"onUpdate:modelValue":e[4]||(e[4]=s=>_.value.secret_key=s),placeholder:"Base32 格式密钥"},null,8,["modelValue"])]),_:1}),l(j,{label:"发行者"},{default:i(()=>[l(h,{modelValue:_.value.issuer,"onUpdate:modelValue":e[5]||(e[5]=s=>_.value.issuer=s),placeholder:"例如：github.com"},null,8,["modelValue"])]),_:1}),l(j,{label:"备注"},{default:i(()=>[l(ut,{modelValue:_.value.note,"onUpdate:modelValue":e[6]||(e[6]=s=>_.value.note=s),placeholder:"添加备注信息（可选）",autosize:{minRows:2,maxRows:4}},null,8,["modelValue"])]),_:1})]),_:1},8,["data"])]),_:1},8,["visible","header","width"]),l(se,{visible:Q.value,"onUpdate:visible":e[9]||(e[9]=s=>Q.value=s),header:"导入数据",width:U.value?"90%":"500px",onConfirm:it},{default:i(()=>[l(Ee,null,{default:i(()=>[l(j,{label:"导入模式"},{default:i(()=>[l(dt,{modelValue:ne.value,"onUpdate:modelValue":e[8]||(e[8]=s=>ne.value=s)},{default:i(()=>[l(Ie,{value:"merge"},{default:i(()=>[...e[37]||(e[37]=[z("合并到现有数据",-1)])]),_:1}),l(Ie,{value:"replace"},{default:i(()=>[...e[38]||(e[38]=[z("替换现有数据",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(j,{label:"选择文件"},{default:i(()=>[a("input",{type:"file",accept:".json",onChange:nt,ref_key:"fileInputRef",ref:W},null,544)]),_:1})]),_:1})]),_:1},8,["visible","width"]),l(se,{visible:H.value,"onUpdate:visible":e[12]||(e[12]=s=>H.value=s),header:"从模板选择",width:U.value?"95%":"800px",footer:!1},{default:i(()=>[a("div",Ma,[a("div",Oa,[l(h,{modelValue:X.value,"onUpdate:modelValue":e[10]||(e[10]=s=>X.value=s),placeholder:"搜索服务名称...",clearable:"",onChange:De},{"suffix-icon":i(()=>[l(o,{name:"search"})]),_:1},8,["modelValue"]),l(mt,{modelValue:Y.value,"onUpdate:modelValue":e[11]||(e[11]=s=>Y.value=s),placeholder:"所有分类",clearable:"",onChange:De,style:{width:"150px","margin-left":"12px"}},{default:i(()=>[(c(!0),m(P,null,G(he.value,s=>(c(),D(vt,{key:s.name,value:s.name,label:`${s.name} (${s.count})`},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),ht((c(),m("div",ja,[(c(!0),m(P,null,G(be.value,s=>(c(),m("div",{key:s.id,class:"template-item",onClick:w=>Ge(s)},[a("div",Ka,[l(o,{name:s.icon,size:"32px"},null,8,["name"])]),a("div",qa,[a("div",Na,v(s.name),1),a("div",Pa,v(s.description),1)]),l(pt,{size:"small",theme:"default"},{default:i(()=>[z(v(s.category),1)]),_:2},1024)],8,Ba))),128)),be.value.length===0?(c(),m("div",Ga,[l(o,{name:"search",size:"48px"}),e[39]||(e[39]=a("p",null,"没有找到匹配的模板",-1))])):y("",!0)])),[[ft,ie.value]])])]),_:1},8,["visible","width"]),l(se,{visible:N.value,"onUpdate:visible":e[13]||(e[13]=s=>N.value=s),header:"扫描二维码",width:U.value?"90%":"500px",footer:!1,onClose:Ve},{default:i(()=>[a("div",Ja,[te.value?(c(),m("div",Qa,[a("img",{src:te.value,style:{"max-width":"100%","max-height":"300px","border-radius":"8px"}},null,8,Wa)])):y("",!0),a("div",{class:oe(["qr-upload-zone",{dragging:ae.value}]),onDrop:Ye,onDragover:He,onDragleave:Xe,onClick:Qe},[l(o,{name:"cloud-upload",size:"48px",style:{color:"#0052d9","margin-bottom":"16px"}}),e[40]||(e[40]=a("div",{class:"upload-text-primary"}," 📤 点击选择 / 拖拽图片 / Ctrl+V 粘贴 ",-1)),e[41]||(e[41]=a("div",{class:"upload-text-secondary"}," 支持 JPG、PNG 格式，最大 10MB ",-1)),e[42]||(e[42]=a("div",{class:"upload-tips"},[a("div",{class:"tip-item"},"💡 确保图片清晰完整"),a("div",{class:"tip-item"},"💡 包含完整的二维码区域"),a("div",{class:"tip-item"},"💡 支持 Google / Microsoft Authenticator 等标准格式")],-1)),a("input",{ref_key:"qrFileInput",ref:ze,type:"file",accept:"image/*",style:{display:"none"},onChange:We},null,544)],34),e[43]||(e[43]=a("div",{style:{"margin-top":"16px",color:"#999","font-size":"13px","text-align":"left"}},[a("p",null,[a("strong",null,"使用方法：")]),a("p",null,"• 点击上方区域选择图片"),a("p",null,"• 拖拽图片到上方区域"),a("p",null,"• 复制图片后按 Ctrl+V 粘贴"),a("p",null,"• 系统将自动解析二维码并填充密钥")],-1))])]),_:1},8,["visible","width"])])}}},es=xt(Ha,[["__scopeId","data-v-e83d36a1"]]);export{es as default};
