import{a as C}from"./index-DT9TBuYH.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as m,k as I,h as de,c as x,b as a,a as t,w as l,d,M as h,o as u,t as c,f as _,m as f,l as N,D as re}from"./index-DNqqV_T_.js";const ue={class:"users-page"},ce={class:"stat-content"},ve={class:"stat-icon",style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}},me={class:"stat-info"},_e={class:"stat-value"},fe={class:"stat-content"},pe={class:"stat-icon",style:{background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"}},ge={class:"stat-info"},we={class:"stat-value"},ye={class:"stat-content"},he={class:"stat-icon",style:{background:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"}},be={class:"stat-info"},ke={class:"stat-value"},Ue={class:"stat-content"},Ve={class:"stat-icon",style:{background:"linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)"}},Ce={class:"stat-info"},xe={class:"stat-value"},ze={class:"page-header"},De={class:"header-left"},Se={key:0,class:"last-login"},Ke={key:1,class:"text-placeholder"},Be={class:"role-option"},Le={class:"role-option"},Ne={key:0,class:"user-detail"},$e={class:"detail-row"},Ae={class:"detail-value"},Me={class:"detail-row"},Pe={class:"detail-value"},Re={class:"detail-row"},qe={class:"detail-value"},Ee={class:"detail-row"},Te={class:"detail-value"},We={class:"detail-row"},Fe={class:"detail-value"},Ie={class:"detail-row"},je={class:"detail-value"},Ge={key:0,class:"detail-row"},He={class:"detail-value"},Je={__name:"Users",setup(Oe){const $=m(!1),g=m([]),b=m(!1),A=m(!1),M=m(""),n=m({}),R=m(null),z=m(""),r=m(null),P=m(window.innerWidth<=768),D=I(()=>{const s=g.value.length,e=g.value.filter(v=>v.is_active).length,i=g.value.reduce((v,k)=>v+(k.secret_count||0),0),p=g.value.filter(v=>{if(!v.last_login)return!1;const k=new Date().toDateString(),w=new Date(v.last_login).toDateString();return k===w}).length;return{totalUsers:s,activeUsers:e,totalSecrets:i,todayActive:p}}),j=[{colKey:"id",title:"ID",width:80},{colKey:"username",title:"用户名",width:150},{colKey:"email",title:"邮箱",ellipsis:!0},{colKey:"role",title:"角色",width:120},{colKey:"is_active",title:"状态",width:100},{colKey:"created_at",title:"注册时间",width:180},{colKey:"last_login",title:"最后登录",width:180},{colKey:"operation",title:"操作",width:180,fixed:"right"}],S=m({current:1,pageSize:10,total:0}),G={username:[{required:!0,message:"请输入用户名"},{min:3,message:"用户名至少3个字符"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码至少6个字符"}],role:[{required:!0,message:"请选择角色"}]},H=I(()=>{let s=g.value;if(z.value){const e=z.value.toLowerCase();s=s.filter(i=>i.username.toLowerCase().includes(e)||i.email&&i.email.toLowerCase().includes(e))}return S.value.total=s.length,s}),K=s=>s?new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",B=async()=>{$.value=!0;try{const s=await C.getUsers();s.data.success&&(g.value=s.data.data)}catch(s){console.error("加载用户失败:",s),h.error("加载用户列表失败")}finally{$.value=!1}},J=()=>{M.value="添加用户",n.value={username:"",password:"",email:"",role:"user",is_active:1},b.value=!0},O=s=>{M.value="编辑用户",n.value={id:s.id,username:s.username,email:s.email,role:s.role,is_active:s.is_active},b.value=!0},Q=s=>{r.value=s,A.value=!0},X=async()=>{if(!await R.value.validate())return!1;try{n.value.id?(await C.updateUser(n.value.id,n.value),h.success("用户更新成功")):(await C.createUser(n.value),h.success("用户创建成功")),B(),b.value=!1,q()}catch(e){return console.error("操作失败:",e),!1}},Y=async s=>{try{await C.updateUser(s.id,{is_active:s.is_active}),h.success(s.is_active?"用户已启用":"用户已禁用"),B()}catch(e){console.error("状态切换失败:",e),s.is_active=s.is_active?0:1}},Z=async s=>{if(s.role==="admin"&&s.username==="admin"){h.warning("不能删除默认管理员");return}if(await re.confirm({header:"删除用户",body:`确定要删除用户 "${s.username}" 吗？此操作不可恢复！`,theme:"danger",confirmBtn:"删除",cancelBtn:"取消"}))try{await C.deleteUser(s.id),h.success("用户已删除"),B()}catch(i){console.error("删除失败:",i)}},q=()=>{n.value={}},ee=s=>{S.value.current=s.current,S.value.pageSize=s.pageSize},te=()=>{P.value=window.innerWidth<=768};return de(()=>{B(),window.addEventListener("resize",te)}),(s,e)=>{const i=d("t-icon"),p=d("t-card"),v=d("t-col"),k=d("t-row"),w=d("t-input"),L=d("t-button"),y=d("t-tag"),ae=d("t-switch"),E=d("t-space"),le=d("t-table"),U=d("t-form-item"),T=d("t-option"),se=d("t-select"),W=d("t-radio"),oe=d("t-radio-group"),ie=d("t-form"),F=d("t-dialog");return u(),x("div",ue,[a(k,{gutter:[16,16],class:"stats-row"},{default:l(()=>[a(v,{xs:12,sm:6,md:6,lg:3},{default:l(()=>[a(p,{"hover-shadow":"",class:"stat-card"},{default:l(()=>[t("div",ce,[t("div",ve,[a(i,{name:"user",size:"24px"})]),t("div",me,[e[8]||(e[8]=t("div",{class:"stat-label"},"总用户数",-1)),t("div",_e,c(D.value.totalUsers),1)])])]),_:1})]),_:1}),a(v,{xs:12,sm:6,md:6,lg:3},{default:l(()=>[a(p,{"hover-shadow":"",class:"stat-card"},{default:l(()=>[t("div",fe,[t("div",pe,[a(i,{name:"user-checked",size:"24px"})]),t("div",ge,[e[9]||(e[9]=t("div",{class:"stat-label"},"活跃用户",-1)),t("div",we,c(D.value.activeUsers),1)])])]),_:1})]),_:1}),a(v,{xs:12,sm:6,md:6,lg:3},{default:l(()=>[a(p,{"hover-shadow":"",class:"stat-card"},{default:l(()=>[t("div",ye,[t("div",he,[a(i,{name:"secured",size:"24px"})]),t("div",be,[e[10]||(e[10]=t("div",{class:"stat-label"},"密钥总数",-1)),t("div",ke,c(D.value.totalSecrets),1)])])]),_:1})]),_:1}),a(v,{xs:12,sm:6,md:6,lg:3},{default:l(()=>[a(p,{"hover-shadow":"",class:"stat-card"},{default:l(()=>[t("div",Ue,[t("div",Ve,[a(i,{name:"user-talk",size:"24px"})]),t("div",Ce,[e[11]||(e[11]=t("div",{class:"stat-label"},"今日活跃",-1)),t("div",xe,c(D.value.todayActive),1)])])]),_:1})]),_:1})]),_:1}),t("div",ze,[t("div",De,[e[12]||(e[12]=t("h2",null,"用户列表",-1)),a(w,{modelValue:z.value,"onUpdate:modelValue":e[0]||(e[0]=o=>z.value=o),placeholder:"搜索用户名或邮箱...",clearable:"",style:{width:"300px"}},{"prefix-icon":l(()=>[a(i,{name:"search"})]),_:1},8,["modelValue"])]),a(L,{theme:"primary",onClick:J},{icon:l(()=>[a(i,{name:"add"})]),default:l(()=>[e[13]||(e[13]=_(" 添加用户 ",-1))]),_:1})]),a(p,{style:{"margin-top":"16px"}},{default:l(()=>[a(le,{data:H.value,columns:j,"row-key":"id",loading:$.value,stripe:"",hover:"",pagination:S.value,onPageChange:ee},{role:l(({row:o})=>[o.role==="admin"?(u(),f(y,{key:0,theme:"danger",variant:"light"},{default:l(()=>[a(i,{name:"user-setting"}),e[14]||(e[14]=_(" 管理员 ",-1))]),_:1})):(u(),f(y,{key:1,theme:"primary",variant:"light"},{default:l(()=>[a(i,{name:"user"}),e[15]||(e[15]=_(" 普通用户 ",-1))]),_:1}))]),is_active:l(({row:o})=>[a(ae,{modelValue:o.is_active,"onUpdate:modelValue":V=>o.is_active=V,"custom-value":[1,0],onChange:V=>Y(o)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),created_at:l(({row:o})=>[_(c(K(o.created_at)),1)]),last_login:l(({row:o})=>[o.last_login?(u(),x("span",Se,c(K(o.last_login)),1)):(u(),x("span",Ke,"从未登录"))]),operation:l(({row:o})=>[a(E,null,{default:l(()=>[a(L,{size:"small",variant:"outline",onClick:V=>Q(o)},{default:l(()=>[a(i,{name:"view"})]),_:1},8,["onClick"]),a(L,{size:"small",theme:"primary",variant:"outline",onClick:V=>O(o)},{default:l(()=>[a(i,{name:"edit"})]),_:1},8,["onClick"]),a(L,{size:"small",theme:"danger",variant:"outline",onClick:V=>Z(o),disabled:o.role==="admin"&&o.username==="admin"},{default:l(()=>[a(i,{name:"delete"})]),_:1},8,["onClick","disabled"])]),_:2},1024)]),_:1},8,["data","loading","pagination"])]),_:1}),a(F,{visible:b.value,"onUpdate:visible":e[6]||(e[6]=o=>b.value=o),header:M.value,width:P.value?"90%":"500px",onConfirm:X,onClose:q},{default:l(()=>[a(ie,{ref_key:"formRef",ref:R,data:n.value,rules:G,"label-align":"top"},{default:l(()=>[a(U,{label:"用户名",name:"username"},{default:l(()=>[a(w,{modelValue:n.value.username,"onUpdate:modelValue":e[1]||(e[1]=o=>n.value.username=o),placeholder:"请输入用户名（至少3个字符）"},null,8,["modelValue"])]),_:1}),n.value.id?N("",!0):(u(),f(U,{key:0,label:"密码",name:"password"},{default:l(()=>[a(w,{modelValue:n.value.password,"onUpdate:modelValue":e[2]||(e[2]=o=>n.value.password=o),type:"password",placeholder:"请输入密码（至少6个字符）"},null,8,["modelValue"])]),_:1})),a(U,{label:"邮箱",name:"email"},{default:l(()=>[a(w,{modelValue:n.value.email,"onUpdate:modelValue":e[3]||(e[3]=o=>n.value.email=o),placeholder:"请输入邮箱（可选）"},null,8,["modelValue"])]),_:1}),a(U,{label:"角色",name:"role"},{default:l(()=>[a(se,{modelValue:n.value.role,"onUpdate:modelValue":e[4]||(e[4]=o=>n.value.role=o),placeholder:"选择用户角色"},{default:l(()=>[a(T,{value:"user",label:"普通用户"},{default:l(()=>[t("div",Be,[a(i,{name:"user"}),e[16]||(e[16]=t("span",null,"普通用户",-1))])]),_:1}),a(T,{value:"admin",label:"管理员"},{default:l(()=>[t("div",Le,[a(i,{name:"user-setting"}),e[17]||(e[17]=t("span",null,"管理员",-1))])]),_:1})]),_:1},8,["modelValue"])]),_:1}),n.value.id?(u(),f(U,{key:1,label:"状态",name:"is_active"},{default:l(()=>[a(oe,{modelValue:n.value.is_active,"onUpdate:modelValue":e[5]||(e[5]=o=>n.value.is_active=o)},{default:l(()=>[a(W,{value:1},{default:l(()=>[...e[18]||(e[18]=[_("启用",-1)])]),_:1}),a(W,{value:0},{default:l(()=>[...e[19]||(e[19]=[_("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})):N("",!0)]),_:1},8,["data"])]),_:1},8,["visible","header","width"]),a(F,{visible:A.value,"onUpdate:visible":e[7]||(e[7]=o=>A.value=o),header:"用户详情",width:P.value?"90%":"500px",footer:!1},{default:l(()=>[r.value?(u(),x("div",Ne,[t("div",$e,[e[20]||(e[20]=t("div",{class:"detail-label"},"用户名",-1)),t("div",Ae,c(r.value.username),1)]),t("div",Me,[e[21]||(e[21]=t("div",{class:"detail-label"},"邮箱",-1)),t("div",Pe,c(r.value.email||"未设置"),1)]),t("div",Re,[e[24]||(e[24]=t("div",{class:"detail-label"},"角色",-1)),t("div",qe,[r.value.role==="admin"?(u(),f(y,{key:0,theme:"danger"},{default:l(()=>[...e[22]||(e[22]=[_("管理员",-1)])]),_:1})):(u(),f(y,{key:1,theme:"primary"},{default:l(()=>[...e[23]||(e[23]=[_("普通用户",-1)])]),_:1}))])]),t("div",Ee,[e[27]||(e[27]=t("div",{class:"detail-label"},"状态",-1)),t("div",Te,[r.value.is_active?(u(),f(y,{key:0,theme:"success"},{default:l(()=>[...e[25]||(e[25]=[_("启用",-1)])]),_:1})):(u(),f(y,{key:1,theme:"default"},{default:l(()=>[...e[26]||(e[26]=[_("禁用",-1)])]),_:1}))])]),t("div",We,[e[28]||(e[28]=t("div",{class:"detail-label"},"注册时间",-1)),t("div",Fe,c(K(r.value.created_at)),1)]),t("div",Ie,[e[29]||(e[29]=t("div",{class:"detail-label"},"最后登录",-1)),t("div",je,c(r.value.last_login?K(r.value.last_login):"从未登录"),1)]),r.value.stats?(u(),x("div",Ge,[e[30]||(e[30]=t("div",{class:"detail-label"},"数据统计",-1)),t("div",He,[a(E,{direction:"vertical",size:"small"},{default:l(()=>[t("div",null,"密钥数："+c(r.value.stats.secretCount||0),1),t("div",null,"分类数："+c(r.value.stats.categoryCount||0),1),t("div",null,"标签数："+c(r.value.stats.tagCount||0),1)]),_:1})])])):N("",!0)])):N("",!0)]),_:1},8,["visible","width"])])}}},Ze=ne(Je,[["__scopeId","data-v-7eb286a4"]]);export{Ze as default};
