import{u as L,v as N,b as B,r as i,c as I,o as K,s as T,d as g,e as p,f as v,g as t,h as l,t as w,w as d,q as z,j as h,m as F,M as A,l as y}from"./index-dd4b05ce.js";import{a as P,u as R}from"./index-ad289ca7.js";import{_ as U}from"./_plugin-vue_export-helper-c27b6911.js";const j={class:"login-container"},D={class:"login-header"},E={class:"brand"},G={class:"brand-logo rounded-md"},H={class:"brand-meta"},J={class:"login-subtitle"},O={class:"login-form"},Q={key:0,class:"input-wrapper"},W={class:"input-wrapper"},X={key:0,class:"password-hint"},Y={key:0,class:"login-footer"},Z={class:"login-footer"},ee={__name:"Login",setup(se){const k=L(),m=N(),b=B(),n=i(!1),f=i(!1),u=i(null),a=i(!0),o=i({username:m.query.username||"",password:""});m.query.username&&(a.value=!1);const V=I(()=>(a.value||o.value.username.length>0)&&o.value.password.length>0);K(()=>{x()});const x=()=>{T(()=>{var s;if(!a.value&&!o.value.username){const e=document.querySelector('input[placeholder="用户名"]');e==null||e.focus()}else u.value&&((s=u.value.$el.querySelector("input"))==null||s.focus())})},C=()=>{var s;u.value&&((s=u.value.$el.querySelector("input"))==null||s.focus())},$=()=>{a.value=!a.value,o.value.password="",a.value||(o.value.username=m.query.username||""),x()},M=()=>{f.value=!0,setTimeout(()=>{f.value=!1},500)},S=async()=>{if(V.value){n.value=!0;try{if(a.value){const s=await P.login({username:"admin",password:o.value.password});s.data.success&&(b.login(s.data.data.token,s.data.data.user),A.success("登录成功"),k.push("/admin"))}else{const s=await R.login({username:o.value.username,password:o.value.password});s.data.success&&(b.login(s.data.data.token,s.data.data.user),A.success("登录成功"),k.push("/"))}}catch(s){console.error("登录失败:",s),M(),o.value.password="",C()}finally{n.value=!1}}};return(s,e)=>{const _=g("t-icon"),c=g("t-button"),q=g("t-input");return p(),v("div",j,[t("div",{class:F(["login-card app-card fade-in",{shake:f.value}])},[t("div",D,[t("div",E,[t("div",G,[l(_,{name:a.value?"secured":"user"},null,8,["name"])]),t("div",H,[e[4]||(e[4]=t("h1",{class:"login-title"},"2FA Authenticator",-1)),t("p",J,w(a.value?"管理员登录":"用户登录"),1)])]),l(c,{variant:"text",size:"small",onClick:$,class:"switch-btn"},{default:d(()=>[l(_,{name:a.value?"user":"secured"},null,8,["name"]),t("span",null,"切换到"+w(a.value?"用户":"管理员")+"登录",1)]),_:1})]),t("div",O,[a.value?h("",!0):(p(),v("div",Q,[l(q,{modelValue:o.value.username,"onUpdate:modelValue":e[0]||(e[0]=r=>o.value.username=r),size:"large",placeholder:"用户名",disabled:n.value,onKeyup:z(C,["enter"])},{"prefix-icon":d(()=>[l(_,{name:"user"})]),_:1},8,["modelValue","disabled"])])),t("div",W,[l(q,{ref_key:"passwordInput",ref:u,modelValue:o.value.password,"onUpdate:modelValue":e[1]||(e[1]=r=>o.value.password=r),type:"password",size:"large",placeholder:a.value?"管理员密码":"密码",onKeyup:z(S,["enter"]),disabled:n.value},null,8,["modelValue","placeholder","disabled"]),a.value?(p(),v("div",X,"请输入管理员密码")):h("",!0)]),l(c,{theme:"primary",size:"large",block:"",loading:n.value,disabled:!V.value,onClick:S,class:"login-button"},{default:d(()=>[y(w(n.value?"登录中...":"登录"),1)]),_:1},8,["loading","disabled"])]),a.value?h("",!0):(p(),v("div",Y,[e[6]||(e[6]=t("span",null,"还没有账号？",-1)),l(c,{variant:"text",size:"small",onClick:e[2]||(e[2]=r=>s.$router.push("/register"))},{default:d(()=>[...e[5]||(e[5]=[y("立即注册",-1)])]),_:1})])),t("div",Z,[l(c,{variant:"text",size:"small",onClick:e[3]||(e[3]=r=>s.$router.push("/"))},{default:d(()=>[...e[7]||(e[7]=[y(" 返回首页 ",-1)])]),_:1})])],2)])}}},le=U(ee,[["__scopeId","data-v-205fef38"]]);export{le as default};
