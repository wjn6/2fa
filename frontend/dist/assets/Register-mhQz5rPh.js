import{j as x,r as p,k as z,c as P,a as r,b as s,d as u,w as o,q as h,u as R,o as q,A,f as _,t as S,M as C}from"./index-DNqqV_T_.js";import{u as U}from"./index-DT9TBuYH.js";import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U.js";const N={class:"register-container"},T={class:"register-icon"},F={class:"register-footer"},K={__name:"Register",setup(M){const w=R();x();const a=p({username:"",email:"",password:"",confirmPassword:""}),c=p(null),t=p(!1),f=p(!1),b={username:[{required:!0,message:"请输入用户名"},{min:3,message:"用户名至少3个字符"}],password:[{required:!0,message:"请输入密码"},{min:6,message:"密码至少6个字符"}],confirmPassword:[{required:!0,message:"请确认密码"},{validator:i=>i===a.value.password,message:"两次密码不一致"}]},V=z(()=>a.value.username.length>=3&&a.value.password.length>=6&&a.value.password===a.value.confirmPassword),y=()=>{f.value=!0,setTimeout(()=>{f.value=!1},500)},v=async()=>{if(await c.value.validate()){t.value=!0;try{(await U.register({username:a.value.username,password:a.value.password,email:a.value.email||null})).data.success&&(C.success({content:"注册成功！正在跳转登录...",duration:2e3}),setTimeout(()=>{w.push({path:"/login",query:{username:a.value.username}})},1e3))}catch(e){console.error("注册失败:",e),y()}finally{t.value=!1}}};return(i,e)=>{const n=u("t-icon"),d=u("t-input"),m=u("t-form-item"),g=u("t-button"),k=u("t-form");return q(),P("div",N,[r("div",{class:h(["register-box",{shake:f.value}])},[r("div",T,[s(n,{name:"user-add"})]),e[7]||(e[7]=r("h1",{class:"register-title"},"创建账号",-1)),e[8]||(e[8]=r("p",{class:"register-subtitle"},"注册 2FA Authenticator",-1)),s(k,{ref_key:"formRef",ref:c,data:a.value,rules:b,onSubmit:v},{default:o(()=>[s(m,{name:"username"},{default:o(()=>[s(d,{modelValue:a.value.username,"onUpdate:modelValue":e[0]||(e[0]=l=>a.value.username=l),size:"large",placeholder:"用户名（至少3个字符）",disabled:t.value},{"prefix-icon":o(()=>[s(n,{name:"user"})]),_:1},8,["modelValue","disabled"])]),_:1}),s(m,{name:"email"},{default:o(()=>[s(d,{modelValue:a.value.email,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.email=l),size:"large",type:"email",placeholder:"邮箱（可选）",disabled:t.value},{"prefix-icon":o(()=>[s(n,{name:"mail"})]),_:1},8,["modelValue","disabled"])]),_:1}),s(m,{name:"password"},{default:o(()=>[s(d,{modelValue:a.value.password,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.password=l),size:"large",type:"password",placeholder:"密码（至少6个字符）",disabled:t.value},{"prefix-icon":o(()=>[s(n,{name:"lock-on"})]),_:1},8,["modelValue","disabled"])]),_:1}),s(m,{name:"confirmPassword"},{default:o(()=>[s(d,{modelValue:a.value.confirmPassword,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.confirmPassword=l),size:"large",type:"password",placeholder:"确认密码",disabled:t.value,onKeyup:A(v,["enter"])},{"prefix-icon":o(()=>[s(n,{name:"lock-on"})]),_:1},8,["modelValue","disabled"])]),_:1}),s(g,{theme:"primary",size:"large",block:"",type:"submit",loading:t.value,disabled:!V.value,class:"register-button"},{default:o(()=>[_(S(t.value?"注册中...":"立即注册"),1)]),_:1},8,["loading","disabled"])]),_:1},8,["data"]),r("div",F,[e[6]||(e[6]=r("span",null,"已有账号？",-1)),s(g,{variant:"text",size:"small",onClick:e[4]||(e[4]=l=>i.$router.push("/login"))},{default:o(()=>[...e[5]||(e[5]=[_(" 立即登录 ",-1)])]),_:1})])],2)])}}},E=B(K,[["__scopeId","data-v-c0450574"]]);export{E as default};
