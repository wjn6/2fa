import{a as N}from"./index-DT9TBuYH.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as g,y as E,h as ae,M as C,c as w,a as i,b as e,w as t,d as r,o as m,f as n,t as o,m as T,l as k}from"./index-DNqqV_T_.js";const le={class:"admin-secrets"},se={class:"page-header"},ne={class:"text-secondary"},oe={class:"secret-info"},ie={class:"secret-name"},re={class:"secret-issuer"},ue={key:1,class:"text-secondary"},ce={class:"date-info"},de={class:"text-secondary small"},_e={key:0,class:"secret-detail"},me={key:0,class:"statistics-content"},fe={class:"stat-card"},pe={class:"stat-value"},ve={class:"stat-card"},ge={class:"stat-value"},ye={__name:"Secrets",setup(he){const z=g(!1),B=g([]),u=g(null),f=g(null),V=g(!1),K=g(!1),c=E({username:"",name:"",issuer:""}),_=E({current:1,pageSize:20,total:0}),F=[{colKey:"user",title:"所属用户",width:200,cell:"user"},{colKey:"secret",title:"密钥信息",width:200,cell:"secret"},{colKey:"category",title:"分类",width:120,cell:"category"},{colKey:"flags",title:"标记",width:120,cell:"flags"},{colKey:"use_count",title:"使用次数",width:100,cell:"use_count"},{colKey:"created_at",title:"创建时间",width:150,cell:"created_at"},{colKey:"operation",title:"操作",width:120,fixed:"right",cell:"operation"}],j=[{colKey:"username",title:"用户名"},{colKey:"secret_count",title:"密钥数量"},{colKey:"total_usage",title:"总使用次数"}],q=[{colKey:"username",title:"用户"},{colKey:"name",title:"密钥名称"},{colKey:"issuer",title:"发行者"},{colKey:"use_count",title:"使用次数"}];ae(()=>{p()});async function p(){z.value=!0;try{const s={page:_.current,pageSize:_.pageSize,...c},a=await N.getAllSecrets(s);a.data.success&&(B.value=a.data.data.secrets,_.total=a.data.data.pagination.total)}catch(s){console.error("加载密钥列表失败:",s),C.error("加载密钥列表失败")}finally{z.value=!1}}function G(){_.current=1,p()}function H(){c.username="",c.name="",c.issuer="",_.current=1,p()}function I(s){_.current=s.current,_.pageSize=s.pageSize,p()}function J(s){u.value=s,V.value=!0}async function O(s){try{(await N.deleteSecret(s)).data.success&&(C.success("密钥删除成功"),p())}catch(a){console.error("删除密钥失败:",a),C.error("删除密钥失败")}}async function Q(){try{const s=await N.getSecretStatistics();s.data.success&&(f.value=s.data.data,K.value=!0)}catch(s){console.error("加载统计数据失败:",s),C.error("加载统计数据失败")}}function R(s){return s?new Date(s).toLocaleDateString("zh-CN"):"-"}function W(s){return s?new Date(s).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):"-"}function L(s){return s?new Date(s).toLocaleString("zh-CN"):"-"}return(s,a)=>{const y=r("t-icon"),v=r("t-button"),h=r("t-space"),U=r("t-input"),x=r("t-form-item"),X=r("t-form"),M=r("t-card"),b=r("t-tag"),Y=r("t-popconfirm"),D=r("t-table"),d=r("t-descriptions-item"),Z=r("t-descriptions"),P=r("t-dialog"),A=r("t-col"),ee=r("t-row"),$=r("t-divider");return m(),w("div",le,[i("div",se,[a[7]||(a[7]=i("h3",null,"密钥管理",-1)),e(h,null,{default:t(()=>[e(v,{theme:"default",onClick:p},{icon:t(()=>[e(y,{name:"refresh"})]),default:t(()=>[a[5]||(a[5]=n(" 刷新 ",-1))]),_:1}),e(v,{theme:"default",onClick:Q},{icon:t(()=>[e(y,{name:"chart-pie"})]),default:t(()=>[a[6]||(a[6]=n(" 统计分析 ",-1))]),_:1})]),_:1})]),e(M,{class:"filter-card"},{default:t(()=>[e(X,{data:c,layout:"inline"},{default:t(()=>[e(x,{label:"用户名"},{default:t(()=>[e(U,{modelValue:c.username,"onUpdate:modelValue":a[0]||(a[0]=l=>c.username=l),placeholder:"输入用户名",clearable:""},null,8,["modelValue"])]),_:1}),e(x,{label:"密钥名称"},{default:t(()=>[e(U,{modelValue:c.name,"onUpdate:modelValue":a[1]||(a[1]=l=>c.name=l),placeholder:"输入密钥名称",clearable:""},null,8,["modelValue"])]),_:1}),e(x,{label:"发行者"},{default:t(()=>[e(U,{modelValue:c.issuer,"onUpdate:modelValue":a[2]||(a[2]=l=>c.issuer=l),placeholder:"输入发行者",clearable:""},null,8,["modelValue"])]),_:1}),e(x,null,{default:t(()=>[e(h,null,{default:t(()=>[e(v,{theme:"primary",onClick:G},{icon:t(()=>[e(y,{name:"search"})]),default:t(()=>[a[8]||(a[8]=n(" 搜索 ",-1))]),_:1}),e(v,{onClick:H},{default:t(()=>[...a[9]||(a[9]=[n("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1}),e(M,{class:"table-card"},{default:t(()=>[e(D,{data:B.value,columns:F,loading:z.value,pagination:_,onPageChange:I,"row-key":"id",bordered:"",stripe:"",hover:""},{user:t(({row:l})=>[e(h,{align:"center"},{default:t(()=>[e(b,{theme:"primary",variant:"light"},{default:t(()=>[n(o(l.username),1)]),_:2},1024),i("span",ne,o(l.email),1)]),_:2},1024)]),secret:t(({row:l})=>[i("div",oe,[i("div",ie,o(l.name),1),i("div",re,o(l.issuer||"-"),1)])]),category:t(({row:l})=>[l.category_name?(m(),T(b,{key:0,theme:"success",variant:"outline"},{default:t(()=>[n(o(l.category_name),1)]),_:2},1024)):(m(),w("span",ue,"未分类"))]),flags:t(({row:l})=>[e(h,null,{default:t(()=>[l.is_favorite?(m(),T(b,{key:0,theme:"warning",size:"small"},{default:t(()=>[e(y,{name:"star-filled",size:"12px"}),a[10]||(a[10]=n(" 收藏 ",-1))]),_:1})):k("",!0),l.is_pinned?(m(),T(b,{key:1,theme:"primary",size:"small"},{default:t(()=>[e(y,{name:"pin-filled",size:"12px"}),a[11]||(a[11]=n(" 置顶 ",-1))]),_:1})):k("",!0)]),_:2},1024)]),use_count:t(({row:l})=>[e(b,{theme:"default",variant:"light"},{default:t(()=>[n(o(l.use_count||0),1)]),_:2},1024)]),created_at:t(({row:l})=>[i("div",ce,[i("div",null,o(R(l.created_at)),1),i("div",de,o(W(l.created_at)),1)])]),operation:t(({row:l})=>[e(h,null,{default:t(()=>[e(v,{size:"small",variant:"text",theme:"primary",onClick:S=>J(l)},{default:t(()=>[...a[12]||(a[12]=[n(" 查看 ",-1)])]),_:1},8,["onClick"]),e(Y,{content:"确定要删除这个密钥吗？此操作不可恢复！",onConfirm:S=>O(l.id)},{default:t(()=>[e(v,{size:"small",variant:"text",theme:"danger"},{default:t(()=>[...a[13]||(a[13]=[n(" 删除 ",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)]),_:1},8,["data","loading","pagination"])]),_:1}),e(P,{visible:V.value,"onUpdate:visible":a[3]||(a[3]=l=>V.value=l),header:"密钥详情",width:"600px"},{default:t(()=>[u.value?(m(),w("div",_e,[e(Z,{bordered:""},{default:t(()=>[e(d,{label:"所属用户"},{default:t(()=>[n(o(u.value.username),1)]),_:1}),e(d,{label:"用户邮箱"},{default:t(()=>[n(o(u.value.email||"-"),1)]),_:1}),e(d,{label:"密钥名称",span:"2"},{default:t(()=>[n(o(u.value.name),1)]),_:1}),e(d,{label:"发行者",span:"2"},{default:t(()=>[n(o(u.value.issuer||"-"),1)]),_:1}),e(d,{label:"分类"},{default:t(()=>[n(o(u.value.category_name||"未分类"),1)]),_:1}),e(d,{label:"使用次数"},{default:t(()=>[n(o(u.value.use_count||0),1)]),_:1}),e(d,{label:"备注",span:"2"},{default:t(()=>[n(o(u.value.note||"-"),1)]),_:1}),e(d,{label:"创建时间"},{default:t(()=>[n(o(L(u.value.created_at)),1)]),_:1}),e(d,{label:"最后使用"},{default:t(()=>[n(o(u.value.last_used_at?L(u.value.last_used_at):"从未使用"),1)]),_:1})]),_:1})])):k("",!0)]),_:1},8,["visible"]),e(P,{visible:K.value,"onUpdate:visible":a[4]||(a[4]=l=>K.value=l),header:"密钥统计分析",width:"800px"},{default:t(()=>{var l;return[f.value?(m(),w("div",me,[e(ee,{gutter:16},{default:t(()=>[e(A,{span:12},{default:t(()=>[i("div",fe,[a[14]||(a[14]=i("div",{class:"stat-title"},"总密钥数",-1)),i("div",pe,o(f.value.totalSecrets),1)])]),_:1}),e(A,{span:12},{default:t(()=>{var S;return[i("div",ve,[a[15]||(a[15]=i("div",{class:"stat-title"},"活跃用户",-1)),i("div",ge,o(((S=f.value.byUser)==null?void 0:S.length)||0),1)])]}),_:1})]),_:1}),e($),a[16]||(a[16]=i("h4",null,"按用户统计",-1)),e(D,{data:f.value.byUser,columns:j,size:"small","max-height":"300px"},null,8,["data"]),e($),a[17]||(a[17]=i("h4",null,"最活跃密钥 (Top 10)",-1)),e(D,{data:(l=f.value.mostUsed)==null?void 0:l.slice(0,10),columns:q,size:"small","max-height":"300px"},null,8,["data"])])):k("",!0)]}),_:1},8,["visible"])])}}},Ce=te(ye,[["__scopeId","data-v-78c75556"]]);export{Ce as default};
