import{a as S}from"./index-DT9TBuYH.js";import{_ as N}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as M,k as g,h as T,c as r,a as t,b as e,w as o,d as m,o as i,t as u,F as p,g as b,p as x,l as V}from"./index-DNqqV_T_.js";const A={class:"dashboard"},E={class:"stat-content"},F={class:"stat-icon",style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}},O={class:"stat-info"},U={class:"stat-value"},$={class:"stat-content"},H={class:"stat-icon",style:{background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"}},R={class:"stat-info"},W={class:"stat-value"},j={class:"stat-content"},q={class:"stat-icon",style:{background:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"}},G={class:"stat-info"},J={class:"stat-value"},P={class:"stat-content"},Q={class:"stat-icon",style:{background:"linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)"}},X={class:"stat-info"},Y={class:"stat-value"},Z={class:"chart-container"},tt={class:"bar-chart"},st={class:"bar-label"},et={class:"bar-wrapper"},at={class:"bar-value"},ot={class:"chart-container"},lt={class:"pie-chart"},nt={class:"pie-visual"},ct={class:"pie-legend"},dt={class:"legend-label"},rt={class:"legend-value"},it={class:"chart-container"},ut={class:"line-chart"},_t=["title"],vt={key:0,class:"line-bar-label"},ht={__name:"Dashboard",setup(ft){const f=M({}),v=M({}),z=[{colKey:"name",title:"名称"},{colKey:"issuer",title:"发行者"},{colKey:"use_count",title:"使用次数"}],y=g(()=>{var a,s,c,l;return[{label:"今日登录",count:((a=v.value.users)==null?void 0:a.todayLogins)||0,color:"linear-gradient(90deg, #667eea, #764ba2)"},{label:"本周登录",count:((s=v.value.users)==null?void 0:s.weekLogins)||0,color:"linear-gradient(90deg, #f093fb, #f5576c)"},{label:"活跃用户",count:((c=v.value.users)==null?void 0:c.activeUsers)||0,color:"linear-gradient(90deg, #4facfe, #00f2fe)"},{label:"今日操作",count:((l=v.value.activity)==null?void 0:l.todayOperations)||0,color:"linear-gradient(90deg, #43e97b, #38f9d7)"}]}),B=g(()=>{const a=y.value.map(s=>s.count);return Math.max(...a,1)}),w=g(()=>{var c;const a=((c=v.value.categories)==null?void 0:c.distribution)||[],s=["#667eea","#f093fb","#4facfe","#43e97b","#fa709a","#fee140","#30cfd0"];return a.map((l,d)=>({name:l.name,count:l.count,percentage:l.percentage||0,color:s[d%s.length]}))}),k=g(()=>{var s;const a=((s=v.value.trends)==null?void 0:s.last30Days)||[];if(a.length===0){const c=[],l=new Date;for(let d=29;d>=0;d--){const h=new Date(l);h.setDate(h.getDate()-d),c.push({date:h.toISOString().split("T")[0],count:Math.floor(Math.random()*20)})}return c}return a}),C=g(()=>{const a=k.value.map(s=>s.count);return Math.max(...a,1)});function I(a,s){return s===0?0:Math.max(a/s*100,3)}function K(a,s){return s===0?0:Math.max(a/s*100,5)}const D=async()=>{try{const a=await S.getStatistics();f.value=a.data.data;try{const s=await S.getEnhancedStatistics();s.data.success&&(v.value=s.data.data)}catch(s){console.error("加载增强统计失败:",s)}}catch(a){console.error("加载统计失败:",a)}};return T(()=>{D(),setInterval(D,3e4)}),(a,s)=>{const c=m("t-icon"),l=m("t-card"),d=m("t-col"),h=m("t-row"),L=m("t-table");return i(),r("div",A,[s[4]||(s[4]=t("div",{class:"dashboard-header"},[t("h1",null,"统计仪表盘"),t("span",{class:"update-time"},"最后更新：刚刚")],-1)),e(h,{gutter:[16,16],class:"stats-row"},{default:o(()=>[e(d,{xs:12,sm:12,md:6,lg:6,xl:6},{default:o(()=>[e(l,{"hover-shadow":"",class:"stat-card"},{default:o(()=>[t("div",E,[t("div",F,[e(c,{name:"secured",size:"24px"})]),t("div",O,[s[0]||(s[0]=t("div",{class:"stat-label"},"密钥总数",-1)),t("div",U,u(f.value.totalSecrets||0),1)])])]),_:1})]),_:1}),e(d,{xs:12,sm:12,md:6,lg:6,xl:6},{default:o(()=>[e(l,{"hover-shadow":"",class:"stat-card"},{default:o(()=>[t("div",$,[t("div",H,[e(c,{name:"folder",size:"24px"})]),t("div",R,[s[1]||(s[1]=t("div",{class:"stat-label"},"分类总数",-1)),t("div",W,u(f.value.totalCategories||0),1)])])]),_:1})]),_:1}),e(d,{xs:12,sm:12,md:6,lg:6,xl:6},{default:o(()=>[e(l,{"hover-shadow":"",class:"stat-card"},{default:o(()=>[t("div",j,[t("div",q,[e(c,{name:"discount",size:"24px"})]),t("div",G,[s[2]||(s[2]=t("div",{class:"stat-label"},"标签总数",-1)),t("div",J,u(f.value.totalTags||0),1)])])]),_:1})]),_:1}),e(d,{xs:12,sm:12,md:6,lg:6,xl:6},{default:o(()=>[e(l,{"hover-shadow":"",class:"stat-card"},{default:o(()=>[t("div",P,[t("div",Q,[e(c,{name:"user",size:"24px"})]),t("div",X,[s[3]||(s[3]=t("div",{class:"stat-label"},"用户总数",-1)),t("div",Y,u(f.value.totalUsers||0),1)])])]),_:1})]),_:1})]),_:1}),e(h,{gutter:[16,16],class:"charts-row"},{default:o(()=>[e(d,{xs:24,sm:24,md:12,lg:12,xl:12},{default:o(()=>[e(l,{title:"用户活跃度",class:"chart-card"},{default:o(()=>[t("div",Z,[t("div",tt,[(i(!0),r(p,null,b(y.value,(n,_)=>(i(),r("div",{key:_,class:"bar-item"},[t("div",st,u(n.label),1),t("div",et,[t("div",{class:"bar-fill",style:x({width:I(n.count,B.value)+"%",background:n.color})},[t("span",at,u(n.count),1)],4)])]))),128))])])]),_:1})]),_:1}),e(d,{xs:24,sm:24,md:12,lg:12,xl:12},{default:o(()=>[e(l,{title:"密钥分类分布",class:"chart-card"},{default:o(()=>[t("div",ot,[t("div",lt,[t("div",nt,[(i(!0),r(p,null,b(w.value,(n,_)=>(i(),r("div",{key:_,class:"pie-segment",style:x({background:n.color,flex:n.percentage})},null,4))),128))]),t("div",ct,[(i(!0),r(p,null,b(w.value,(n,_)=>(i(),r("div",{key:_,class:"legend-item"},[t("div",{class:"legend-color",style:x({background:n.color})},null,4),t("span",dt,u(n.name),1),t("span",rt,u(n.count)+" ("+u(n.percentage)+"%)",1)]))),128))])])])]),_:1})]),_:1})]),_:1}),e(h,{gutter:[16,16],class:"charts-row"},{default:o(()=>[e(d,{xs:24,sm:24,md:24,lg:24,xl:24},{default:o(()=>[e(l,{title:"30天趋势",class:"chart-card"},{default:o(()=>[t("div",it,[t("div",ut,[(i(!0),r(p,null,b(k.value,(n,_)=>(i(),r("div",{key:_,class:"line-bar",title:`${n.date}: ${n.count}`},[t("div",{class:"line-bar-fill",style:x({height:K(n.count,C.value)+"%"})},null,4),_%5===0?(i(),r("div",vt,u(n.date.split("-")[2]),1)):V("",!0)],8,_t))),128))])])]),_:1})]),_:1})]),_:1}),e(l,{title:"最常使用密钥",class:"table-card"},{default:o(()=>[e(L,{data:f.value.topSecrets||[],columns:z,"max-height":400,stripe:"",hover:""},null,8,["data"])]),_:1})])}}},bt=N(ht,[["__scopeId","data-v-2948f044"]]);export{bt as default};
