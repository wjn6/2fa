import{Y as a,a6 as e,r as s,c as l,o as u,n,O as r,P as o,Q as t,Z as d,b as i,a1 as v,$ as c,a5 as p,a0 as m,R as f,E as g}from"./vendor-d600c78b.js";import{u as h}from"./index-64ce2276.js";import{a as w,u as y}from"./index-42d0e3ec.js";import{_ as b}from"./_plugin-vue_export-helper-1b428a4d.js";import{M as _}from"./ui-703c31fd.js";import"./utils-783a0963.js";const k={class:"login-container"},x={class:"login-header"},j={class:"brand"},q={class:"brand-logo rounded-md"},z={class:"brand-meta"},V={class:"login-subtitle"},$={class:"login-form"},C={key:0,class:"input-wrapper"},S={class:"input-wrapper"},A={key:0,class:"password-hint"},I={key:0,class:"login-footer"},K={class:"login-footer"},U=b({__name:"Login",setup(b){const U=a(),E=e(),F=h(),L=s(!1),M=s(!1),O=s(null),P=s(!0),Q=s({username:E.query.username||"",password:""});E.query.username&&(P.value=!1);const R=l(()=>(P.value||Q.value.username.length>0)&&Q.value.password.length>0);u(()=>{T()});const T=()=>{n(()=>{var a;if(P.value||Q.value.username)O.value&&(null==(a=O.value.$el.querySelector("input"))||a.focus());else{const a=document.querySelector('input[placeholder="用户名"]');null==a||a.focus()}})},Y=()=>{var a;O.value&&(null==(a=O.value.$el.querySelector("input"))||a.focus())},Z=()=>{P.value=!P.value,Q.value.password="",P.value||(Q.value.username=E.query.username||""),T()},B=async()=>{if(R.value){L.value=!0;try{if(P.value){const a=await w.login({username:"admin",password:Q.value.password});a.data.success&&(F.login(a.data.data.token,a.data.data.user),_.success("登录成功"),U.push("/admin"))}else{const a=await y.login({username:Q.value.username,password:Q.value.password});a.data.success&&(F.login(a.data.data.token,a.data.data.user),_.success("登录成功"),U.push("/"))}}catch(a){M.value=!0,setTimeout(()=>{M.value=!1},500),Q.value.password="",Y()}finally{L.value=!1}}};return(a,e)=>{const s=r("t-icon"),l=r("t-button"),u=r("t-input");return o(),t("div",k,[d("div",{class:f(["login-card app-card fade-in",{shake:M.value}])},[d("div",x,[d("div",j,[d("div",q,[i(s,{name:P.value?"secured":"user"},null,8,["name"])]),d("div",z,[e[4]||(e[4]=d("h1",{class:"login-title"},"2FA Authenticator",-1)),d("p",V,v(P.value?"管理员登录":"用户登录"),1)])]),i(l,{variant:"text",size:"small",onClick:Z,class:"switch-btn"},{default:c(()=>[i(s,{name:P.value?"user":"secured"},null,8,["name"]),d("span",null,"切换到"+v(P.value?"用户":"管理员")+"登录",1)]),_:1})]),d("div",$,[P.value?m("",!0):(o(),t("div",C,[i(u,{modelValue:Q.value.username,"onUpdate:modelValue":e[0]||(e[0]=a=>Q.value.username=a),size:"large",placeholder:"用户名",disabled:L.value,onKeyup:p(Y,["enter"])},{"prefix-icon":c(()=>[i(s,{name:"user"})]),_:1},8,["modelValue","disabled"])])),d("div",S,[i(u,{ref_key:"passwordInput",ref:O,modelValue:Q.value.password,"onUpdate:modelValue":e[1]||(e[1]=a=>Q.value.password=a),type:"password",size:"large",placeholder:P.value?"管理员密码":"密码",onKeyup:p(B,["enter"]),disabled:L.value},null,8,["modelValue","placeholder","disabled"]),P.value?(o(),t("div",A,"请输入管理员密码")):m("",!0)]),i(l,{theme:"primary",size:"large",block:"",loading:L.value,disabled:!R.value,onClick:B,class:"login-button"},{default:c(()=>[g(v(L.value?"登录中...":"登录"),1)]),_:1},8,["loading","disabled"])]),P.value?m("",!0):(o(),t("div",I,[e[6]||(e[6]=d("span",null,"还没有账号？",-1)),i(l,{variant:"text",size:"small",onClick:e[2]||(e[2]=e=>a.$router.push("/register"))},{default:c(()=>[...e[5]||(e[5]=[g("立即注册",-1)])]),_:1})])),d("div",K,[i(l,{variant:"text",size:"small",onClick:e[3]||(e[3]=e=>a.$router.push("/"))},{default:c(()=>[...e[7]||(e[7]=[g(" 返回首页 ",-1)])]),_:1})])],2)])}}},[["__scopeId","data-v-205fef38"]]);export{U as default};
