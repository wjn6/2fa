import{Y as a,a4 as s,r as e,o as l,O as t,P as o,Q as u,Z as r,b as d,a1 as n,a0 as i,a5 as c,$ as p,_ as v,R as w,E as h,n as m}from"./vendor-d600c78b.js";import{u as f}from"./index-64ce2276.js";import{a as k}from"./index-42d0e3ec.js";import{_ as b}from"./_plugin-vue_export-helper-1b428a4d.js";import{M as y}from"./ui-703c31fd.js";import"./utils-783a0963.js";const _={class:"unlock-container"},g={class:"unlock-icon"},$={class:"unlock-title"},P={key:0,class:"hint-box"},x={class:"password-wrapper"},V={class:"password-hint"},j={class:"unlock-footer"},M=b({__name:"Unlock",setup(b){const M=a(),{t:U}=s(),z=f(),S=e(!1),T=e(!0),C=e(""),H=e(!1),q=e(null),I=e({password:""}),E=e(!1),K=e({password:"",hint:""}),O={password:[{required:!0,message:U("auth.enterPassword")},{min:6,message:U("auth.passwordTooShort")}]},Q=()=>{m(()=>{var a;q.value&&(null==(a=q.value.$el.querySelector("input"))||a.focus())})},R=async()=>{if(I.value.password){S.value=!0;try{const a=await k.unlock({password:I.value.password});a.data.success&&(z.unlock(a.data.data.sessionToken),y.success(U("auth.unlockSuccess")),M.push("/"))}catch(a){H.value=!0,setTimeout(()=>{H.value=!1},500),I.value.password="",Q()}finally{S.value=!1}}},Y=()=>{E.value=!0},Z=async()=>{if(!K.value.password||K.value.password.length<6)y.warning(U("auth.passwordTooShort"));else try{(await k.setMasterPassword(K.value)).data.success&&(y.success(U("common.success")),T.value=!0,E.value=!1,C.value=K.value.hint,I.value.password=K.value.password,R())}catch(a){}};return l(()=>{(async()=>{try{const a=await k.checkMasterPassword();if(T.value=a.data.data.hasPassword,T.value){const a=await k.getPasswordHint();C.value=a.data.data.hint,Q()}else E.value=!0}catch(a){}})()}),(a,s)=>{const e=t("t-icon"),l=t("t-input"),m=t("t-button"),f=t("t-form-item"),k=t("t-form"),b=t("t-dialog");return o(),u("div",_,[r("div",{class:w(["unlock-box",{shake:H.value}])},[r("div",g,[d(e,{name:"lock-on"})]),r("h1",$,n(a.$t("auth.unlock")),1),C.value?(o(),u("div",P,[d(e,{name:"info-circle",size:"14px"}),r("span",null,n(C.value),1)])):i("",!0),r("div",x,[d(l,{ref_key:"passwordInput",ref:q,modelValue:I.value.password,"onUpdate:modelValue":s[0]||(s[0]=a=>I.value.password=a),type:"password",size:"large",placeholder:a.$t("auth.enterPassword"),onKeyup:c(R,["enter"]),disabled:S.value},null,8,["modelValue","placeholder","disabled"]),r("div",V,n(a.$t("auth.enterMasterPassword")),1)]),d(m,{theme:"primary",size:"large",block:"",loading:S.value,disabled:!I.value.password,onClick:R,class:"unlock-button"},{default:p(()=>[h(n(S.value?a.$t("auth.unlocking"):a.$t("auth.unlock")),1)]),_:1},8,["loading","disabled"]),r("div",j,[T.value?i("",!0):(o(),v(m,{key:0,variant:"text",size:"small",onClick:Y},{default:p(()=>[h(n(a.$t("auth.setMasterPassword")),1)]),_:1}))])],2),d(b,{visible:E.value,"onUpdate:visible":s[3]||(s[3]=a=>E.value=a),header:a.$t("auth.setMasterPassword"),width:"500px",onConfirm:Z},{default:p(()=>[d(k,{data:K.value,rules:O},{default:p(()=>[d(f,{label:a.$t("auth.password"),name:"password"},{default:p(()=>[d(l,{modelValue:K.value.password,"onUpdate:modelValue":s[1]||(s[1]=a=>K.value.password=a),type:"password"},null,8,["modelValue"])]),_:1},8,["label"]),d(f,{label:a.$t("auth.passwordHint"),name:"hint"},{default:p(()=>[d(l,{modelValue:K.value.hint,"onUpdate:modelValue":s[2]||(s[2]=a=>K.value.hint=a),placeholder:a.$t("auth.passwordHint")+"（可选）"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1},8,["visible","header"])])}}},[["__scopeId","data-v-72705969"]]);export{M as default};
